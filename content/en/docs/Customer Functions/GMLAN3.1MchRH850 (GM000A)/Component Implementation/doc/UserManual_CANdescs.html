---
title: UserManual_CANdescs
linkTitle: UserManual_CANdescs
weight: 53
---

<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=1></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_1.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_2.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_3.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_4.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_5.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_6.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_7.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-1_8.jpg"/><br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>&#160;<br/>&#160;<br/>&#160;<br/>&#160;<br/>&#160;</b><br/>
<b>User Manual&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;&#160;CANdesc &#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;&#160;</b>A Step by Step Introduction<br/>
<b>Version 1.7&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;&#160;English</b>&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
&#160;<br/>
&#160;<br/>
<hr/>
<a name=2></a>&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>Impressum&#160;<br/></b>&#160;<br/>Vector Informatik&#160;GmbH&#160;<br/>Ingersheimer Straße 24&#160;<br/>D-70499 Stuttgart&#160;<br/>&#160;<br/>&#160;<br/>The information&#160;and data given in&#160;this user&#160;manual can be changed&#160;without&#160;prior notice. No&#160;part of this manual may&#160;be&#160;reproduced in&#160;<br/>any&#160;form or by&#160;any&#160;means&#160;without the&#160;written permission of the&#160;publisher, regardless of which method&#160;or&#160;which instruments, electronic&#160;<br/>or mechanical, are used. All technical information, drafts, etc. are liable to law&#160;of copyright protection.&#160;<br/>&#160;©&#160;Copyright 2009, Vector Informatik GmbH &#160;<br/>All&#160;rights&#160;reserved.&#160;<br/>
&#160;<br/>
<hr/>
<a name=3></a>User Manual CANdesc &#160;<br/>
Manual Information&#160;<br/>
<b>Manual History&#160;</b><br/>
<b>Author&#160;</b><br/>
<b>Date&#160;</b><br/>
<b>Version&#160;</b><br/>
<b>Details&#160;</b><br/>
Klaus Emmert&#160;<br/>
2004-05-10&#160;<br/>
1.1&#160;<br/>
Vector&#160;symbols included,&#160;template&#160;<br/>version 1.8 used (this history&#160;<br/>included), AppDesc… changed to&#160;<br/>ApplDesc due to software&#160;<br/>modifications,&#160;description of GENy&#160;<br/>as generation&#160;tool added, testing of&#160;<br/>diagnostics layer described&#160;with&#160;<br/>CANoe demo&#160;configuration,&#160;further&#160;<br/>Information about diagnostic buffer&#160;<br/>(linear and ring buffer mechanism)&#160;<br/>and the repeated service&#160;call&#160;<br/>feature&#160;<br/>
Klaus Emmert&#160;<br/>
2004-10-15&#160;<br/>
1.2&#160;<br/>
Modifications&#160;after Review.&#160;<br/>
Klaus Emmert&#160;<br/>
2005-08-12&#160;<br/>
1.3&#160;<br/>
Two new functions:&#160;<br/>DescTimerTask(),&#160;<br/>DescStateTask().&#160;&#160;<br/>These two functions can be used&#160;<br/>instead of DescTask to handle the&#160;<br/>timers and the application&#160;<br/>separately.&#160;<br/>
Klaus Emmert&#160;<br/>
2006-03-24&#160;<br/>
1.4&#160;<br/>
Issues in example code fixed&#160;<br/>Document overview added&#160;<br/>
Oliver Garnatz&#160;<br/>
2007-01-12&#160;<br/>
1.5&#160;<br/>
Added description of&#160;<br/>CANdesc_ConnectorCAN GENy&#160;<br/>component&#160;<br/>
Klaus Emmert&#160;<br/>
2008-01-28&#160;<br/>
1.6&#160;<br/>
References&#160;fixed&#160;<br/>
Manuela Scheufele&#160;<br/>
2009-07-27&#160;<br/>
1.7&#160;<br/>
(see&#160;sect<a href="UserManual_CANdescs.html#66">ion&#160;Version 1.7</a>&#160;on page&#160;<br/><a href="UserManual_CANdescs.html#66">66) &#160;</a><br/>
&#160;<br/>
&#160;<br/>
<b>Reference Documents&#160;</b><br/>
<b>No.&#160;</b><br/>
<b>Source&#160;</b><br/>
<b>Title&#160;</b><br/>
[1]&#160;<br/>
Vector Informatik&#160;&#160;Technical Reference&#160;CANdesc&#160;<br/>
[2]&#160;<br/>
Vector Informatik&#160;&#160;Technical Reference&#160;CANdescBasic&#160;<br/>
&#160;&#160;<br/>&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 3 -&#160;<br/>
<hr/>
<a name=4></a>Manual Information&#160;<br/>
User Manual CANdesc&#160;<br/>
Inhaltsverzeichnis&#160;<br/>
<a href="UserManual_CANdescs.html#6"><b>1</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#6"><b>Manual Information&#160;</b></a><br/>
<a href="UserManual_CANdescs.html#6"><b>6</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#7">1.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#7">About this user manual&#160;</a><br/>
<a href="UserManual_CANdescs.html#7">7&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">1.1.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">Certification&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">8&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">1.1.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">Warranty&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">8&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">1.1.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">Registered trademarks&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">8&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">1.1.4&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">Errata Sheet of manufacturers&#160;</a><br/>
<a href="UserManual_CANdescs.html#8">8&#160;</a><br/>
<a href="UserManual_CANdescs.html#9"><b>2</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#9"><b>Getting&#160;Started&#160;</b></a><br/>
<a href="UserManual_CANdescs.html#9"><b>9</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#10">2.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#10">How to use this Manual&#160;</a><br/>
<a href="UserManual_CANdescs.html#10">10&#160;</a><br/>
<a href="UserManual_CANdescs.html#11"><b>3</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#11"><b>Basic Information&#160;11</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">3.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">An Overall View&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">12&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">3.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">What is&#160;Diagnostic&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">13&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">3.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#13">What happens&#160;during Diagnostics?&#160;13&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">3.4&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">What is&#160;CANdesc?&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">14&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">3.5&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">Tools and Files&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">14&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">3.5.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">CANdela Studio, CDDT, CDD&#160;14&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">3.5.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#14">Generation Tool, CDD, DBC&#160;14&#160;</a><br/>
<a href="UserManual_CANdescs.html#15">3.5.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#15">Generation Process with&#160;CANbedded Software&#160;Components&#160;15&#160;</a><br/>
<a href="UserManual_CANdescs.html#15">3.6&#160;</a><br/>
<a href="UserManual_CANdescs.html#15">What&#160;CANdesc&#160;does&#160;</a><br/>
<a href="UserManual_CANdescs.html#15">15&#160;</a><br/>
<a href="UserManual_CANdescs.html#17">3.7&#160;</a><br/>
<a href="UserManual_CANdescs.html#17">Diagnostics –&#160;a more detailed View&#160;17&#160;<br/></a><a href="UserManual_CANdescs.html#18">3.7.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#18">Basic&#160;Nomenclature from the Bottom Up&#160;18&#160;</a><br/>
<a href="UserManual_CANdescs.html#19">3.7.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#19">The same Nomenclature from the Top Down&#160;19&#160;</a><br/>
<a href="UserManual_CANdescs.html#19">3.7.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#19">Where to find&#160;this Nomenclature in CANdela Studio&#160;19&#160;</a><br/>
<a href="UserManual_CANdescs.html#21">3.7.4&#160;</a><br/>
<a href="UserManual_CANdescs.html#21">Generic&#160;Handling of a Diagnostic Request in the CANdesc Component&#160;21&#160;</a><br/>
<a href="UserManual_CANdescs.html#23">3.7.5&#160;</a><br/>
<a href="UserManual_CANdescs.html#23">User, None, OEM, Generated – what does this&#160;mean?&#160;23&#160;</a><br/>
<a href="UserManual_CANdescs.html#24"><b>4</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#24"><b>A Few&#160;STEPS to CANdesc&#160;24</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">4.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">STEP What do you need before start?&#160;25&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">4.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">Startup Code&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">25&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">4.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">Overview&#160;</a><br/>
<a href="UserManual_CANdescs.html#25">25&#160;</a><br/>
<a href="UserManual_CANdescs.html#26">4.4&#160;</a><br/>
<a href="UserManual_CANdescs.html#26">STEP Installation&#160;</a><br/>
<a href="UserManual_CANdescs.html#26">26&#160;</a><br/>
<a href="UserManual_CANdescs.html#26">4.5&#160;</a><br/>
<a href="UserManual_CANdescs.html#26">STEP Configuration&#160;with the Generation&#160;Tool&#160;26&#160;<br/>4.5.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#26">Using the Generation Tool&#160;CANgen&#160;26&#160;</a><br/>
<a href="UserManual_CANdescs.html#27">4.5.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#27">Using the Generation Tool&#160;GENy&#160;27&#160;</a><br/>
<a href="UserManual_CANdescs.html#29">4.6&#160;</a><br/>
<a href="UserManual_CANdescs.html#29">STEP Generating Files&#160;</a><br/>
<a href="UserManual_CANdescs.html#29">29&#160;</a><br/>
<a href="UserManual_CANdescs.html#29">4.6.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#29">Using Generation Tool CANgen&#160;29&#160;</a><br/>
<a href="UserManual_CANdescs.html#32">4.6.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#32">Using the Generation Tool&#160;GENy&#160;32&#160;</a><br/>
<a href="UserManual_CANdescs.html#32">4.7&#160;</a><br/>
<a href="UserManual_CANdescs.html#32">STEP Add CANbedded to&#160;your Project&#160;32&#160;</a><br/>
<a href="UserManual_CANdescs.html#33">4.8&#160;</a><br/>
<a href="UserManual_CANdescs.html#33">STEP Adapt Your Application Files&#160;33&#160;<br/>4.8.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#33">Including, Initializing and Cyclic Calling&#160;33&#160;</a><br/>
<a href="UserManual_CANdescs.html#35">4.9&#160;</a><br/>
<a href="UserManual_CANdescs.html#35">STEP Functional Connection between your&#160;Application and CANdesc/CANdela&#160;Studio&#160;35&#160;<br/>4.9.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#35">How to handle User-Defined Handlers&#160;35&#160;</a><br/>
<a href="UserManual_CANdescs.html#38">4.9.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#38">How to Handle&#160;Predefined&#160;Handlers (for&#160;MainHandler&#160;only)&#160;38&#160;</a><br/>
<a href="UserManual_CANdescs.html#40">4.9.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#40">Handling OEM-Specific Settings&#160;40&#160;</a><br/>
- 4 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=5></a>User Manual CANdesc &#160;<br/>
Manual Information&#160;<br/>
<a href="UserManual_CANdescs.html#41">4.10&#160;</a><br/>
<a href="UserManual_CANdescs.html#41">STEP Compile and link your Project&#160;41&#160;</a><br/>
<a href="UserManual_CANdescs.html#41">4.11&#160;</a><br/>
<a href="UserManual_CANdescs.html#41">STEP Test&#160;it&#160;via CANoe&#160;41&#160;<br/>4.11.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#41">Start CANoe.CAN OSEK TP enlarged&#160;41&#160;</a><br/>
<a href="UserManual_CANdescs.html#42">4.11.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#42">Test of CANdesc&#160;42&#160;</a><br/>
<a href="UserManual_CANdescs.html#44"><b>5</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#44"><b>Further Information&#160;44</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#45">5.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#45">Diagnostic State Handling&#160;using CANdela Studio&#160;45&#160;</a><br/>
<a href="UserManual_CANdescs.html#45">5.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#45">Typical Examples of State Groups and&#160;States in an&#160;Automotive Environment&#160;45&#160;</a><br/>
<a href="UserManual_CANdescs.html#45">5.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#45">Creating and editing State Groups, States and Transitions&#160;45&#160;</a><br/>
<a href="UserManual_CANdescs.html#47">5.4&#160;</a><br/>
<a href="UserManual_CANdescs.html#47">Connection between the states and your application&#160;47&#160;</a><br/>
<a href="UserManual_CANdescs.html#48">5.5&#160;</a><br/>
<a href="UserManual_CANdescs.html#48">Diagnostic Buffer&#160;</a><br/>
<a href="UserManual_CANdescs.html#48">48&#160;</a><br/>
<a href="UserManual_CANdescs.html#48">5.5.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#48">Linear Diagnostic Buffer&#160;48&#160;</a><br/>
<a href="UserManual_CANdescs.html#49">5.5.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#49">Ring Buffer Mechanism&#160;49&#160;</a><br/>
<a href="UserManual_CANdescs.html#51">5.5.2.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#51">Activation of the Ring Buffer&#160;51&#160;</a><br/>
<a href="UserManual_CANdescs.html#51">5.5.2.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#51">Main Control&#160;Functions for the Ring Buffer Mechanism&#160;51&#160;</a><br/>
<a href="UserManual_CANdescs.html#52">5.5.2.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#52">Examples for&#160;Ring Buffer Mechanism&#160;52&#160;</a><br/>
<a href="UserManual_CANdescs.html#55">5.6&#160;</a><br/>
<a href="UserManual_CANdescs.html#55">Repeated Service Call Feature&#160;55&#160;<br/>5.6.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#55">Activation of the Repeated&#160;Service&#160;Call&#160;55&#160;</a><br/>
<a href="UserManual_CANdescs.html#56">5.6.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#56">Repeated Service Call and&#160;Ring Buffer 1&#160;– “Write and&#160;Check”&#160;56&#160;</a><br/>
<a href="UserManual_CANdescs.html#57">5.6.3&#160;</a><br/>
<a href="UserManual_CANdescs.html#57">Repeated Service Call and&#160;Ring Buffer 2&#160;– “Check and Write”&#160;57&#160;</a><br/>
<a href="UserManual_CANdescs.html#58"><b>6</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#58"><b>Additional Information&#160;58</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#62">6.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#62">Persistors&#160;</a><br/>
<a href="UserManual_CANdescs.html#62">59&#160;</a><br/>
<a href="UserManual_CANdescs.html#60">6.1.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#60">Update Persistors&#160;– Install&#160;current Version&#160;60&#160;</a><br/>
<a href="UserManual_CANdescs.html#63"><b>7</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#63"><b>FAQs&#160;</b></a><br/>
<a href="UserManual_CANdescs.html#63"><b>63</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#64">7.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#64">Introduction&#160;</a><br/>
<a href="UserManual_CANdescs.html#64">64&#160;</a><br/>
<a href="UserManual_CANdescs.html#64">7.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#64">Frequently Asked Questions&#160;64&#160;</a><br/>
<a href="UserManual_CANdescs.html#65"><b>8</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#65"><b>What’s new,&#160;what’s changed&#160;65</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">8.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">Version 1.7&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">66&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">8.1.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">What’s&#160;new&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">66&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">8.1.2&#160;</a><br/>
<a href="UserManual_CANdescs.html#66">What’s&#160;changed&#160;66&#160;</a><br/>
<a href="UserManual_CANdescs.html#68"><b>9</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#68"><b>Address table&#160;67</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#69"><b>10</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#69"><b>Glossar&#160;69</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#70"><b>11</b>&#160;</a><br/>
<a href="UserManual_CANdescs.html#70"><b>Index&#160;</b></a><br/>
<a href="UserManual_CANdescs.html#70"><b>70</b>&#160;</a><br/>
&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 5 -&#160;<br/>
<hr/>
<a name=6></a>Manual Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>1&#160;Manual&#160;</b><br/>
<b>Information&#160;</b><br/>
<b>In this chapter&#160;you find the following&#160;information:&#160;</b><br/>
<a href="UserManual_CANdescs.html#7">1.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#7">About this user manual&#160;&#160;</a><br/>
<a href="UserManual_CANdescs.html#7">page&#160;</a><br/>
<a href="UserManual_CANdescs.html#7">7</a><br/>
&#160;<br/>
<a href="UserManual_CANdescs.html#8">Certification&#160;</a><br/>
&#160;<br/>
<a href="UserManual_CANdescs.html#8">Warranty&#160;</a><br/>
&#160;<br/>
<a href="UserManual_CANdescs.html#8">Registered trademarks&#160;</a><br/>
&#160;<br/>
<a href="UserManual_CANdescs.html#8">Errata Sheet of manufacturers&#160;</a><br/>
&#160;&#160;<br/>&#160;<br/>
- 6 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=7></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-7_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-7_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-7_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-7_4.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-7_5.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-7_6.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-7_7.png"/><br/>
User Manual CANdesc &#160;<br/>
Manual Information&#160;<br/>
<b>1.1&#160;</b><br/>
<b>About this user manual&#160;</b><br/>
Finding information&#160;<br/>
The user manual provides&#160;the following&#160;access help:&#160;<br/>
quickly&#160;<br/>
¼&#160;&#160;At the beginning of each chapter you will&#160;find a summary of the contents,&#160;<br/>¼&#160;&#160;In the header you can see&#160;in which chapter and paragraph you are,&#160;<br/>¼&#160;&#160;In the footer you can see to which version the user&#160;manual replies,&#160;<br/>¼&#160;&#160;At the end of the user&#160;manual you will find an index, with whose help you will&#160;<br/>
quickly find information,&#160;<br/>
¼&#160;&#160;Also at the end of the user&#160;manual you&#160;will find a glossary in which you can look&#160;<br/>
up an explanation of used&#160;technical terms&#160;<br/>
&#160;&#160;<br/>
Conventions&#160;<br/>
In the two following charts&#160;you will find&#160;the conventions used in the user manual&#160;<br/>regarding&#160;utilized spellings and&#160;symbols.&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
<b>Style&#160;</b><br/>
<b>Utilization&#160;</b><br/>
&#160;<br/>
<b>bold&#160;</b><br/>
Blocks, surface elements,&#160;window- and&#160;dialog names of the&#160;<br/>software. Accentuation of&#160;warnings&#160;and&#160;advices.&#160;<br/><b>[OK]</b>&#160;<br/>
&#160;<br/>
Push&#160;buttons&#160;in brackets&#160;<br/>
<b>File</b>|<b>Save</b>&#160;<br/>
Notation for&#160;menus and menu entries&#160;<br/>
&#160;<br/>
MICROSAR&#160;<br/>
Legally protected proper names and side&#160;notes.&#160;<br/>
&#160;<br/>
Source Code&#160;<br/>
File&#160;name&#160;and&#160;source&#160;code.&#160;<br/>
&#160;<br/>
Hyperlink&#160;<br/>
Hyperlinks and references.&#160;<br/>
&#160;<br/>
&lt;CTRL&gt;+&lt;S&gt;&#160;Notation&#160;<br/>
for&#160;<br/>
shortcuts.&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
<b>Symbol&#160;</b><br/>
<b>Utilization&#160;</b><br/>
&#160;<br/>
Here you can&#160;obtain supplemental information.&#160;<br/>
&#160;<br/>
&#160;<br/>
This&#160;symbol calls your attention to warnings.&#160;<br/>
&#160;<br/>
&#160;<br/>
Here you can&#160;find additional information.&#160;<br/>
&#160;<br/>
&#160;<br/>
Here is an example that has been prepared for you.&#160;<br/>
&#160;<br/>
&#160;<br/>
Step-by-step instructions&#160;provide assistance at these&#160;points.&#160;<br/>
&#160;<br/>
&#160;<br/>
Instructions&#160;on editing files&#160;are found at these points.&#160;<br/>&#160;<br/>
&#160;<br/>
&#160;<br/>
This&#160;symbol&#160;warns you not&#160;to edit the specified file.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 7 -&#160;<br/>
<hr/>
<a name=8></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-8_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-8_2.png"/><br/>
Manual Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>1.1.1&#160;&#160;Certification&#160;</b><br/>
Certified Quality&#160;<br/>
Vector Informatik GmbH&#160;has ISO 9001:2000&#160;certification. The ISO standard is&#160;a&#160;<br/>
Management System&#160;&#160;globally recognized standard.&#160;<br/>&#160;&#160;<br/>
Spice Level 3&#160;<br/>
The Embedded Software Components&#160;business area&#160;at Vector Informatik GmbH&#160;<br/>achieved process maturity level 3 during a HIS-conformant assessment.&#160;<br/>
&#160;&#160;<br/>
<b>1.1.2&#160;&#160;Warranty&#160;</b><br/>
Restriction of&#160;<br/>
We reserve the right to change the&#160;contents of the documentation&#160;and the software&#160;<br/>
warranty&#160;<br/>
without notice.&#160;Vector Informatik GmbH&#160;assumes no liability for correct contents&#160;or&#160;<br/>damages&#160;which are resulted from the usage of&#160;the documentation. We are grateful for&#160;<br/>
&#160;<br/>
references&#160;to mistakes&#160;or for suggestions&#160;for improvement to be able to offer you&#160;<br/>even more efficient products in the future.&#160;<br/>
&#160;&#160;<br/>
<b>1.1.3&#160;&#160;Registered trademarks&#160;</b><br/>
Registered&#160;<br/>
All trademarks mentioned in&#160;this documentation and if necessary third party&#160;<br/>
trademarks&#160;<br/>
registered are absolutely subject to the conditions&#160;of each valid label right and the&#160;<br/>rights of particular&#160;registered proprietor.&#160;All trademarks, trade names or&#160;company&#160;<br/>
&#160;<br/>
names&#160;are or can be trademarks or&#160;registered trademarks of their particular&#160;<br/>proprietors. All rights which&#160;are not expressly allowed&#160;are reserved. If an explicit label&#160;<br/>of trademarks, which are used in this&#160;documentation, fails, should not mean that a&#160;<br/>name is free&#160;of third party rights.&#160;<br/>
&#160;<br/>
¼&#160;Outlook,&#160;Windows,&#160;Windows&#160;XP,&#160;Windows 2000,&#160;Windows NT,&#160;Visual Studio&#160;are&#160;<br/>
trademarks of&#160;the Microsoft&#160;Corporation.&#160;<br/>
&#160;&#160;<br/>
<b>1.1.4&#160;&#160;Errata Sheet of manufacturers&#160;</b><br/>
<b>Caution:</b>&#160;Vector only delivers&#160;software!&#160;&#160;<br/>
&#160;<br/>
Your hardware manufacturer will provide&#160;you with the necessary errata sheets&#160;<br/>concerning your used hardware. In case of errata dealing with&#160;CAN please provide us&#160;<br/>the relevant erratas and we will figure out&#160;whether this hardware&#160;problem is already&#160;<br/>known to us&#160;or whether to get a possible workaround. &#160;<br/>
&#160;<br/>
<b>Info:</b>&#160;Because of many NDAs with different hardware&#160;manufacturers or because we&#160;<br/>are not informed about, we are not able&#160;to provide you with information concerning&#160;<br/>
&#160;<br/>
hardware errata of the hardware manufacturers. &#160;<br/>
&#160;<br/>&#160;<br/>
- 8 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=9></a>User Manual CANdesc &#160;<br/>
Getting Started&#160;<br/>
<b>2 Getting&#160;</b><br/>
<b>Started&#160;</b><br/>
<b>In this chapter&#160;you find the following&#160;information:&#160;</b><br/>
2.1&#160;<br/>
How to use this Manual&#160;&#160;<br/>
page&#160;<br/>
10<br/>
&#160;&#160;<br/>&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 9 -&#160;<br/>
<hr/>
<a name=10></a>Getting Started&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>2.1&#160;</b><br/>
<b>How to use this Manual&#160;</b><br/>
&#160;<br/>
Just follow the description&#160;step&#160;by step.&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
FAQ<br/>
To find answers to&#160;special&#160;questions&#160;without reading the whole document use the&#160;<br/>FAQ list (see&#160;section&#160;FAQs&#160;on page&#160;63).&#160;<br/>
&#160;&#160;<br/>
- 10 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=11></a>User Manual CANdesc &#160;<br/>
Basic Information&#160;<br/>
<b>3 Basic&#160;</b><br/>
<b>Information&#160;</b><br/>
<b>In&#160;this chapter&#160;you find the following&#160;information:&#160;</b><br/>
3.2&#160;<br/>
What is&#160;Diagnostic<a href="UserManual_CANdescs.html#63">&#160;</a><br/>
&#160;<br/>
<a href="UserManual_CANdescs.html#63">&#160;page&#160;</a>13<br/>
3.3&#160;<br/>
What happens&#160;during Diagnostics?&#160;&#160;<br/>
page&#160;<br/>
13<br/>
3.4&#160;<br/>
What is&#160;CANdesc?&#160;<br/>
&#160;page&#160;14<br/>
3.5&#160;<br/>
Tools and Files&#160;<br/>
&#160;page&#160;14<br/>
&#160;<br/>
CANdela Studio, CDDT, CDD&#160;<br/>
&#160;<br/>
Generation Tool, CDD, DBC&#160;<br/>
&#160;<br/>
Generation Process with&#160;CANbedded Software&#160;Components&#160;<br/>
3.6&#160;<br/>
What&#160;CANdesc&#160;does&#160;&#160;<br/>
page&#160;<br/>
15<br/>
3.7&#160;<br/>
Diagnostics –&#160;a more detailed View&#160;&#160;<br/>
page&#160;<br/>
17<br/>
&#160;<br/>
Basic&#160;Nomenclature from the Bottom Up&#160;<br/>
&#160;<br/>
The same Nomenclature from the Top Down&#160;<br/>
&#160;<br/>
Where to find&#160;this Nomenclature in CANdela Studio&#160;<br/>
&#160;<br/>
Generic&#160;Handling of a Diagnostic Request in the CANdesc Component&#160;<br/>
&#160;<br/>
User, None, OEM, Generated – what does this&#160;mean?&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 11 -&#160;<br/>
<hr/>
<a name=12></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-12_1.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-12_2.jpg"/><br/>
Basic Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>3.1&#160;</b><br/>
<b>An Overall View&#160;</b><br/>
ECU in the focus&#160;<br/>
What we are&#160;now talking about&#160;is an ECU, a module to&#160;be built-in a&#160;vehicle like&#160;<br/>shown in the&#160;figure below.&#160;Almost every&#160;ECU&#160;participates in a certain bus system&#160;like&#160;<br/>
x<br/>
e.g. CAN, Fle&#160;Ray or LIN.&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
<b>Vehicle&#160;with&#160;different bus&#160;systems<br/></b><br/>
<b>CAN&#160;Highspeed</b><br/>
<br/>
<b>CAN&#160;Lowspeed</b><br/>
<br/>
<b>LIN</b><br/>
<br/>
<b>FlexRay</b><br/>
<br/>
<b>MOST</b><br/>
&#160;&#160;<br/>
&#160;<br/>
So any ECU&#160;within one bus system&#160;has to&#160;provide an&#160;identical interface to this bus&#160;<br/>system because all ECUs have to share&#160;information via this bus system as&#160;you see in&#160;<br/>the figure below.&#160;<br/>
&#160;<br/>
CAN Lowspeed as&#160;<br/>an example bus&#160;<br/>system&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
For that reason all ECUs are built-up in the same way.&#160;There is a&#160;software part to&#160;<br/>realize the main job (application)&#160;of this ECU e.g. to control the engine or a door. The&#160;<br/>other part is the software part to be able&#160;to&#160;communicate with the other ECUs via the&#160;<br/>bus&#160;system that is the communication&#160;software.&#160;<br/>
&#160;&#160;<br/>
- 12 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=13></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-13_1.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-13_2.png"/><br/>
User Manual CANdesc &#160;<br/>
Basic Information&#160;<br/>
&#160;<br/>
Application Software<br/>
Software&#160;for Network&#160;<br/>
Communication and Diagnostics<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>3.2&#160;</b><br/>
<b>What is Diagnostic&#160;</b><br/>
Dia'gno stics&#160;-&#160;<br/>
Diagnostics in a technical&#160;context is the&#160;examination&#160;of a machine. But diagnostics in&#160;<br/>
Detection,&#160;<br/>
this context goes&#160;way beyond this definition. &#160;<br/>
Examination of&#160;a&#160;<br/>
Diagnostics comprises function monitoring,&#160;error detection, fault memory, activation,&#160;<br/>
machine;&#160;<br/>
data acquisition etc. and is&#160;used for variant coding, end-of-line programming,&#160;<br/>
[greek.&#160;<i>diagnoskein</i>&#160;<br/>
reprogramming, identification etc.&#160;<br/>
„analyze deeply,&#160;<br/>differentiate]&#160;<br/>
In contrast to Dia’gno&#160;<br/>&#160;sis – Examination&#160;<br/>(med.)&#160;<br/>
&#160;<br/>&#160;&#160;<br/>
<b>3.3&#160;</b><br/>
<b>What happens during Diagnostics?&#160;</b><br/>
&#160;<br/>
In most cases an Off-Board tester (Client)&#160;sends a diagnostic request to the ECU (via&#160;<br/>CAN) and the&#160;ECU (Server) sends back&#160;a diagnostic response. This&#160;can be a positive&#160;<br/>or a negative response. The following&#160;figure&#160;clearly shows a basic representation&#160;of&#160;<br/>this mechanism.&#160;<br/>
&#160;&#160;<br/>
CANdesc – &#160;<br/>
CAN Diagnostic&#160;<br/>Embedded Software&#160;<br/>Component&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 13 -&#160;<br/>
<hr/>
<a name=14></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-14_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-14_2.png"/><br/>
Basic Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>3.4&#160;</b><br/>
<b>What is CANdesc?&#160;</b><br/>
CANdesc is totally&#160;<br/>
CANdesc stands for&#160;<b>CAN&#160;Diagnostic Embedded Software Component</b>. &#160;<br/>
generated based&#160;<br/>
This&#160;software&#160;component differs from all&#160;other CANbedded Software Components in&#160;<br/>
upon the&#160;CDD file.&#160;<br/>
that it is totally generated. To be able to&#160;generate this&#160;component you need a CDD&#160;<br/>
&#160;<br/>
file, a DBC file and the generation tool&#160;(GENy&#160;/&#160;CANgen).&#160;<br/>
&#160;&#160;<br/>
Generated Software&#160;<br/>Component based&#160;<br/>on .CDD and .DBC&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The CANdesc will be&#160;explained in&#160;the section&#160;Generic&#160;Handling of a Diagnostic&#160;<br/>Request in the CANdesc Component&#160;on page&#160;21, where you will get&#160;detailed insight&#160;<br/>
&#160;<br/>
into the CANdesc Component and how it&#160;works when processing&#160;a diagnostic&#160;<br/>request.&#160;<br/>
&#160;&#160;<br/>
<b>3.5&#160;</b><br/>
<b>Tools and Files&#160;</b><br/>
<b>3.5.1&#160;&#160;CANdela Studio, CDDT, CDD&#160;</b><br/>
All settings you have&#160;&#160;CANdela Studio&#160;is a PC tool. It reads in&#160;the diagnostic template file CDDT and&#160;<br/>
ela&#160;<br/>
to do in CANd<br/>
generates a diagnostic data base, the CDD file.&#160;<br/>
Studio to use&#160;<br/>
The CDDT is&#160;a description&#160;of the OEM diagnostic&#160;specification.&#160;<br/>
CANdesc are&#160;stored&#160;<br/>in the CDD file.&#160;<br/>
All necessary&#160;diagnostic information, such as supported diagnostic services, sub&#160;<br/>services, format, signals, state filters,&#160;state transitions&#160;etc., is described via&#160;CANdela&#160;<br/>Studio&#160;and stored in the&#160;CDD file.&#160;<br/>
To use the CANdesc&#160;component, you need the CDD file and you need to know&#160;how&#160;<br/>to make&#160;the necessary settings&#160;in&#160;CANdela Studio.&#160;<br/>
&#160;&#160;<br/>
<b>3.5.2&#160;&#160;Generation Tool, CDD, DBC&#160;</b><br/>
Remember&#160;to add&#160;<br/>
The generation tool (GENy&#160;/&#160;CANgen) is&#160;a PC Tool, too. It generates configuration&#160;<br/>
the path to the CDD&#160;<br/>
files and&#160;signal interface files for the&#160;CANbedded Software Components. The&#160;<br/>
file in the Generation&#160;&#160;generation tool needs the&#160;DBC file to generate the files.&#160;<br/>
ol&#160;<br/>
To<br/>
&#160;<br/>
&#160;<br/>
The DBC file is designed by&#160;the vehicle manufacturer and distributed to all suppliers&#160;<br/>that develop&#160;an ECU. Thus&#160;every supplier&#160;uses the SAME DBC file for one vehicle&#160;<br/>
There is the same&#160;<br/>
platform and one bus system (powertrain, body CAN&#160;etc.) to guarantee a common&#160;<br/>
DBC file per bus&#160;<br/>
- 14 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=15></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-15_1.png"/><br/>
User Manual CANdesc &#160;<br/>
Basic Information&#160;<br/>
system (high&#160;speed,&#160;<br/>
basis&#160;for development.&#160;<br/>
low speed, etc) for all&#160;&#160;For example, every ECU has to know that a 1 in bit 7&#160;in the 4th&#160;byte of the message&#160;<br/>suppliers to&#160;<br/>
0x305 means “Ignition Key” on/off.&#160;<br/>
guarantee a&#160;<br/>
n&#160;<br/>
commo<br/>
The DBC file contains information about&#160;every node and the messages / sig<br/>
s the&#160;<br/>
nal<br/>
basis&#160;for&#160;<br/>
node has to send and to receive.&#160;<br/>
development&#160;<br/>
When using&#160;CANdesc for&#160;diagnostics the CDD file must be read in&#160;by the generation&#160;<br/>tool, to be able to generate&#160;the CANdesc code.&#160;<br/>
&#160;&#160;<br/>
<b>3.5.3&#160;</b><br/>
<b>n Process w</b><br/>
<b>Generatio</b><br/>
<b>ith CANbedded Software Components&#160;</b><br/>
&#160;<br/>
Normally the generation tool generates files&#160;that contain the configuration and the&#160;<br/>signal interface of the CANbedded&#160;Software Components. CANbedded can be&#160;<br/>compiled and&#160;linked using the source code of each component.&#160;<br/>
&#160;&#160;<br/>
The standard&#160;<br/>generation process&#160;<br/>for Vector Software&#160;<br/>Components.&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
CANdesc is a&#160;<br/>completely&#160;<br/>generated Software&#160;<br/>Component&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
The main difference for CANdesc is&#160;that the source&#160;code&#160;for CANdesc is totally&#160;<br/>generated from&#160;the CDD file&#160;and therefore not included in your delivery as the other&#160;<br/>software&#160;components are. Since the CDD file&#160;contains&#160;most of the information about&#160;<br/>CANdesc, there are only a&#160;few configuration settings left that can be done via the&#160;<br/>generation tool on the CANdesc tab&#160;<br/>
&#160;&#160;<br/>
<b>3.6&#160;</b><br/>
<b>What CANdesc does&#160;</b><br/>
Handles Diagnostic&#160;<br/>
¼&#160;&#160;CANdesc receives addressed requests&#160;physically or/and functionally&#160;<br/>
Communication&#160;<br/>
¼&#160;&#160;CANdesc generates&#160;and handles&#160;a physical or functional request with appropriate&#160;<br/>
response message headers, corresponding to the given KWP2000/UDS (ISO&#160;<br/>14229-1)&#160;Diagnostics on CAN manufacturer specification.&#160;<br/>
¼&#160;&#160;CANdesc connects&#160;to underlying Transport Protocol and handles&#160;the&#160;<br/>
communication errors of the underlying&#160;layers.&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 15 -&#160;<br/>
<hr/>
<a name=16></a>Basic Information&#160;<br/>
User Manual CANdesc&#160;<br/>
¼&#160;&#160;CANdesc is&#160;capable of communication&#160;on any bus systems, using&#160;an own&#160;<br/>
abstraction&#160;interface.&#160;<br/>
&#160;&#160;<br/>
Manages Diagnostic&#160;&#160;¼&#160;&#160;CANdesc keeps the data&#160;consistency, which guarantees that no other request will&#160;<br/>Data (Buffer)&#160;<br/>
delete the current diagnostic request data being processed.&#160;<br/>
&#160;&#160;<br/>
dle<br/>
Han<br/>
s Diagnostic&#160;<br/>
¼&#160;&#160;CANdesc prrovides&#160;centralized diagnostic&#160;error handling based on the method&#160;<br/>
Errors&#160;<br/>
<b>report only&#160;first detected&#160;error</b>.&#160;<br/>
¼&#160;&#160;CANdesc monitors timeouts (e.g. S3- “Tester Present”, P2- “Response pending”,&#160;<br/>
etc.).&#160;<br/>
&#160;&#160;<br/>
Analyzes&#160;Requests&#160;<br/>
¼&#160;&#160;CANdesc&#160;detects relevant SID&#160;(Service&#160;Identifier) for&#160;the ECU. If an SID is not&#160;<br/>
(state machine,&#160;<br/>
supported by the current configuration,&#160;the appropriate&#160;reaction&#160;will&#160;be executed&#160;<br/>
filtering)&#160;<br/>
(e.g. negative&#160;response or&#160;the request will be ignored).&#160;<br/>
¼&#160;&#160;CANdesc analyzes&#160;the service instance. This includes&#160;recognition&#160;of the service-<br/>
specific&#160;sub functions for each&#160;supported&#160;SID. The request length is&#160;validated if it&#160;<br/>is defined&#160;to be constant. For dynamic&#160;fields, the application must do range&#160;<br/>checking of the request length.&#160;<br/>
¼&#160;&#160;CANdesc validates the&#160;states. The&#160;component ensures that a service is only&#160;<br/>
executed&#160;if the diagnostic state allows the&#160;processing&#160;of that service. E. g. some&#160;<br/>services&#160;are only allowed to be executed&#160;inside a special diagnostic session. If&#160;<br/>the current state does not allow the execution, a corresponding negative&#160;<br/>response is&#160;sent automatically.&#160;<br/>
&#160;&#160;<br/>
Processes the&#160;<br/>
¼&#160;&#160;CANdesc generates&#160;a complete diagnostic&#160;handler&#160;function&#160;which fills out the&#160;<br/>
request (optional)&#160;<br/>
correct response data for the application.&#160;<br/>
¼&#160;&#160;CANdesc generates&#160;signal handlers to&#160;help&#160;the application place the response&#160;<br/>
information.&#160;<br/>
¼&#160;&#160;CANdesc generates&#160;a Service MainHandler which will&#160;use data access functions&#160;<br/>
provided&#160;by the application, but will place the information on the&#160;message as&#160;<br/>defined in the&#160;diagnostic data description.&#160;<br/>
¼&#160;&#160;CANdesc dispatches incoming request(s) to&#160;the application (Service MainHandler&#160;<br/>
or signal handler level).&#160;<br/>
&#160;&#160;<br/>
- 16 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=17></a>User Manual CANdesc &#160;<br/>
Basic Information&#160;<br/>
<b>3.7&#160;</b><br/>
<b>Diagnostics – a more detailed View&#160;</b><br/>
<b>&#160;this chapter&#160;</b><br/>
<b>In</b><br/>
<b>you find the following&#160;information:&#160;</b><br/>
3.7.1&#160;&#160;Basic&#160;Nomenclature from the Bottom Up<br/>
&#160;<br/>
&#160;&#160;page&#160;<br/>
18<br/>
3.7.2&#160;&#160;The same Nomenclature from the Top Down&#160;&#160;<br/>
page&#160;<br/>
19<br/>
3.7.3&#160;&#160;Where to find&#160;this Nomenclature in CANdela Studio&#160;&#160;<br/>
page&#160;<br/>
19<br/>
3.7.4&#160;&#160;Generic&#160;Handling of a Diagnostic Request in the CANdesc Component&#160;&#160;<br/>
page&#160;<br/>
21<br/>
3.7.5&#160;&#160;User, None, OEM, Generated – what does this&#160;mean?&#160;&#160;<br/>
page&#160;<br/>
23<br/>
&#160;&#160;<br/>
&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 17 -&#160;<br/>
<hr/>
<a name=18></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-18_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-18_2.png"/><br/>
Basic Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>3.7.1&#160;&#160;Basic Nomenclature from the Bottom Up&#160;</b><br/>
Using the same&#160;<br/>
Basic diagnostic communication is&#160;based upon a request / response mechanism. To&#160;<br/>
expressions does not&#160;&#160;understand the structure of&#160;<br/>
ela Stu<br/>
CANd<br/>
dio&#160;it is&#160;necessary to make&#160;some detailed&#160;<br/>
mean to talk&#160;about&#160;<br/>
naming definitions.&#160;<br/>
the same thing&#160;<br/>
The combin<br/>
e<br/>
ation of a requ&#160;st and responses (positive and negative) forms a&#160;<b>Service</b>,<b>&#160;</b><br/>
&#160;<br/>
as you can see in the figure below. A service&#160;(in the scope of CANdesc) is&#160;a&#160;concrete&#160;<br/>service of an&#160;ECU.&#160;<br/>
This&#160;nomenclature&#160;<br/>should help to&#160;<br/>
Request and&#160;responses are so-called service primitives.&#160;<br/>
proceed with&#160;<br/>CANdesc and&#160;<br/>CANdela.&#160;<br/>&#160;&#160;<br/>
Service Identifier =&#160;<br/>
ID&#160;<br/>
S<br/>
&#160;<br/>
Build-up of Requests&#160;<br/>and Response&#160;<br/>Messages&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Service&#160;<br/>
A&#160;<b>protocol service</b>&#160;is a pattern for a service. The protocol&#160;service defines how the&#160;<br/>service primitives have to be&#160;built up. It&#160;determines the&#160;number and&#160;meaning&#160;of bytes&#160;<br/>
Protocol Service&#160;<br/>
for the sub service, and&#160;specifies the data bytes.&#160;<br/>
Request&#160;<br/>
Response&#160;<br/>
Diagnostic Instance&#160;<br/>
Diagnostic Class &#160;&#160;<br/>&#160;&#160;<br/>
<b>Info:</b>&#160;The order of service identifier, sub service and data bytes can&#160;be found at the&#160;<br/>byte stream level, too.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Request&#160;<br/>
A request is a&#160;service primitive and is created as&#160;shown in figure above. A request is&#160;<br/>always&#160;sent from a tester to&#160;an ECU.&#160;The&#160;ECU processes the request and has to&#160;<br/>send back a response message.&#160;<br/>
&#160;&#160;<br/>
Response&#160;&#160;<br/>
The positive response is&#160;calculated very&#160;easily by just&#160;adding&#160;the value 0x40 (hex&#160;<br/>format) to the&#160;SID of the request. The sub&#160;service is just repeated from the request&#160;<br/>
&#160;<br/>
and the data&#160;depends on the service.&#160;<br/>
The negative response always starts with&#160;0x7F as the&#160;SID followed&#160;by the SID of the&#160;<br/>request. The&#160;error code&#160;shows the reason&#160;for the negative response (e.g.&#160;wrong&#160;<br/>format of the request, …).&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Services&#160;with&#160;the same&#160;sub service (similar functional scope) are combined into the&#160;<br/>same&#160;<b>Diagnostic Instance</b>. This&#160;sub service is&#160;the characteristic&#160;factor for the&#160;<br/>
- 18 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=19></a>User Manual CANdesc &#160;<br/>
Basic Information&#160;<br/>
diagnostic instance.&#160;<br/>
A diagnostic instance is&#160;a part of a&#160;<br/>
<b>nostic cla</b><br/>
<b>diag</b><br/>
<b>ss</b>. &#160;<br/>
A diagnostic&#160;class is&#160;the abstract description of a use&#160;case.&#160;<br/>
This is&#160;shown in the&#160;following two illustrations.&#160;<br/>
&#160;&#160;<br/>
Services<br/>
&#160;<br/>
&#160;with the<br/>
Diagnostic Instance<br/>
ame Su<br/>
s<br/>
bservice are&#160;<br/>
ned int<br/>
combi<br/>
o a&#160;<br/>
Service 4<br/>
Diagnostic Instance&#160;-&#160;<br/>
Service 3<br/>
the Sub Func<br/>
n&#160;<br/>
tio<br/>
Requ<br/>
Req&#160;est<br/>
<b>4000</b><br/>
Serv<br/>
Ser&#160;ice 2<br/>
4000 is&#160;Just an&#160;<br/>
Respo<br/>
sp&#160;nse<br/>
Requ<br/>
Req&#160;est<br/>
<b>4000</b><br/>
<b>4000</b><br/>
(positive)<br/>
Service 1<br/>
Respo<br/>
sp&#160;nse<br/>
Example&#160;<br/>
Respo<br/>
sp&#160;nse<br/>
Requ<br/>
Re<br/>
e<br/>
qu&#160;st<br/>
<b>4000</b><br/>
<b>40</b>(neg<br/>
<b>00</b>ative)<br/>
(positive)<br/>Respo<br/>
sp&#160;nse<br/>
Res<br/>
Re&#160;ponse<br/>
Requ<br/>
Req&#160;est<br/>
(neg<br/>
<b>4000</b><br/>
<b>4000</b>ative)<br/>
(posit<br/>
osi&#160;ive)<br/>
Res<br/>
Re&#160;ponse<br/>
Resp<br/>
Res&#160;onse<br/>
(negat<br/>
eg&#160;iv<br/>
<b>4000&#160;</b>e)<br/>
(positive)<br/>Resp<br/>
Res&#160;onse<br/>
(negative)<br/>
&#160;&#160;<br/>
A&#160;Diagnostic&#160;<br/>
Diagnostic&#160;Class<br/>
Instance is a&#160;part of&#160;<br/>a Diagnostic&#160;<br/>
ss&#160;<br/>
Cla<br/>
Diagnostic Instance&#160;2<br/>
Diagnostic Instance&#160;1<br/>
Diagnostic Instance&#160;<br/>
Service 4<br/>
Service 3<br/>
Request<br/>
<b>100A</b><br/>
Service 2<br/>
Reques<br/>
qu<br/>
t<br/>
es<br/>
<b>100A</b><br/>
Resp<br/>
es&#160;onse<br/>
ons<br/>
Service 4<br/>
<b>100A</b><br/>
(positive)<br/>
Service 1<br/>
Response<br/>
Service 3&#160;Request<br/>
<b>4000</b>pons<br/>
<b>4000</b><br/>
R<br/>
<b>100</b>esp<br/>
<b>A</b><br/>
es&#160;onse<br/>
(posi<br/>
os&#160;tive)<br/>
ons<br/>
ve)<br/>
(negative)<br/>
Req<br/>
Re&#160;uest<br/>
Response<br/>
pons<br/>
<b>4000</b><br/>
Respo<br/>
sp&#160;nse<br/>
Service&#160;2<br/>
Request<br/>
(nega<br/>
<b>4000</b><br/>
(p<br/>
<b>4000&#160;</b>tive)<br/>
(posi<br/>
os&#160;tive)<br/>
Request<br/>
<b>4000</b><br/>
Resp<br/>
Re&#160;o<br/>
sps&#160;nse<br/>
ponse<br/>
pons<br/>
<b>4000</b><br/>
Respo<br/>
sp&#160;nse<br/>
Service 1<br/>
(neg<br/>
<b>40</b>(p&#160;at<br/>
os&#160;iiv<br/>
<b>00</b>tiev)e)<br/>
(p<br/>
Re&#160;os<br/>
sp&#160;it<br/>
o&#160;iv<br/>
n&#160;e)<br/>
se<br/>
Req<br/>
Re&#160;uest<br/>
<b>4000</b><br/>
<b>40</b>Respons<br/>
<b>00</b><br/>
e<br/>
(positive)<br/>
pons<br/>
)<br/>
Respo<br/>
sp&#160;nse<br/>
(negative)<br/>
(<br/>
R&#160;n<br/>
e&#160;eg<br/>
sp&#160;ati<br/>
egon&#160;ve<br/>
se&#160;)<br/>
Response<br/>
Request<br/>
pons<br/>
st<br/>
(neg<br/>
<b>4000</b><br/>
<b>4000</b>ati<br/>
eg<br/>
ve)<br/>
(posi<br/>
pos&#160;tive)<br/>
Response<br/>
pons<br/>
Respo<br/>
sp&#160;nse<br/>
(negativ<br/>
<b>4000&#160;</b>e)<br/>
(posi<br/>
os&#160;tive)<br/>
Respo<br/>
sp&#160;nse<br/>
(negative)<br/>
&#160;&#160;<br/>
<b>3.7.2&#160;</b><br/>
<b>e same Nomenclature from the Top Dow</b><br/>
<b>Th</b><br/>
<b>n&#160;</b><br/>
CANdela is top&#160;<br/>
A&#160;<b>diagnostic&#160;class</b>&#160;is an abstract description of a use&#160;case. &#160;<br/>
own, CANd<br/>
d<br/>
esc&#160;<br/>
A&#160;<b>diagnostic&#160;instance</b>&#160;is&#160;derived from a diagnostic class. Some diagnostic&#160;classes&#160;<br/>
bottom up – try to&#160;<br/>
can be instantiated only once. Any diagnostic instance&#160;is unique and can be&#160;<br/>
understand both&#160;<br/>
distinguished from&#160;another diagnostic&#160;instance&#160;via its sub service&#160;(e.g<br/>
).&#160;<br/>
. data identifier<br/>
directions.&#160;<br/>
A diagnostic instance&#160;contains&#160;services.&#160;<br/>
<b>Service</b>s are&#160;composed of the three&#160;<b>service primitives</b>: request, positive response&#160;<br/>and negative response. The&#160;<b>protocol service</b>&#160;is&#160;the pattern for the service, the&#160;<br/>grammar definition. &#160;<br/>
The service primitive&#160;<b>data</b>&#160;is&#160;a co<br/>
n<br/>
ncrete i&#160;formation unit exchanged&#160;between the&#160;<br/>
tester and the&#160;ECU. In the automotive environment you call them&#160;signals, too.&#160;<br/>
&#160;&#160;<br/>
<b>.7.3&#160;</b><br/>
<b>3</b><br/>
<b>Where to find this Nomenclature in CANdela Studio&#160;</b><br/>
Getting around&#160;in&#160;<br/>
To generate&#160;CANdesc you&#160;will have to make&#160;settings in the CDD&#160;file, i.e.&#160;you will&#160;<br/>
CANdela Studio &#160;<br/>
have to work&#160;with&#160;CANdela&#160;Studio. That’s the reason&#160;why it is very importa<br/>
you&#160;<br/>
nt that&#160;<br/>
get to know&#160;the areas in the&#160;CANdela Studio where to make the necessary settings. &#160;<br/>
Below there is&#160;a screenshot of&#160;CANdela Studio.&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 19 -&#160;<br/>
<hr/>
<a name=20></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-20_1.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-20_2.png"/><br/>
Basic Information&#160;<br/>
User Manual CANdesc&#160;<br/>
See the Diagnostics&#160;<br/>Classes&#160;and&#160;<br/>Diagnostic Instances&#160;<br/>in the CANdela&#160;<br/>Studio tree structure&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
The structure&#160;within&#160;CANdela Studio&#160;is top down. In the tree on the left of&#160;CANdela&#160;<br/>Studio&#160;you will find the diagnostic class&#160;and the&#160;diagnostic instances as&#160;shown in&#160;the&#160;<br/>figure above.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;To get familiar&#160;with the idea of diagnostic classes and diagnostic instances,&#160;<br/>have a look&#160;at&#160;all supported&#160;diagnostic classes. Verify for yourself what is meant by&#160;<br/>
&#160;<br/>
<b>abstract&#160;description of a&#160;use case</b>,&#160;e.g.&#160;talking about&#160;Sessions,&#160;Security&#160;Access,&#160;<br/>Fault Memory…&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
If you&#160;click on&#160;a Service Instance you get a&#160;window like the following&#160;figure. Use&#160;this&#160;<br/>figure to understand the different areas&#160;on the diagnostic instance&#160;window and to&#160;<br/>close the gap&#160;between the nomenclature&#160;in the section above and it appears in&#160;<br/>CANdela Studio.&#160;<br/>
&#160;&#160;<br/>
- 20 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=21></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-21_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-21_2.png"/><br/>
User Manual CANdesc &#160;<br/>
Basic Information&#160;<br/>
Diagnostic Instance&#160;<br/>window of CANdela&#160;<br/>Studio – a very&#160;<br/>important window&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>3.7.4&#160;&#160;Generic Handling of a Diagnostic&#160;Request in the CANdesc Component&#160;</b><br/>
What happens&#160;in the&#160;&#160;Now you know&#160;the basic diagnostic elements&#160;and the build-up of diagnostic services.&#160;<br/>CANdesc if a&#160;<br/>
Now we take&#160;a closer look&#160;at how the diagnostic&#160;services&#160;are processed by CANdesc.&#160;<br/>
diagnostic message&#160;<br/>
You also need&#160;to know&#160;these processing&#160;steps so you can&#160;control and adapt this&#160;<br/>
received?&#160;<br/>
process.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;For this&#160;adaptation you have to use&#160;CANdela Studio.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
The following&#160;figure shows the processing of a diagnostic&#160;service in detail.&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 21 -&#160;<br/>
<hr/>
<a name=22></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-22_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-22_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-22_3.png"/><br/>
Basic Information&#160;<br/>
User Manual CANdesc&#160;<br/>
Processing&#160;a&#160;<br/>Diagnostic Message&#160;<br/>received by&#160;<br/>CANdesc and the&#160;<br/>connections&#160;to the&#160;<br/>Application.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
n&#160;&#160;Everything starts&#160;with a diagnostic request from a tester to the ECU.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The path of this message through&#160;the&#160;CAN Driver and the Transport Protocol is&#160;<br/>not shown in&#160;the illustration.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
o&#160;&#160;Now this incoming diagnostic request will&#160;be checked in&#160;different ways. Is the SID&#160;<br/>
supported in the ECU? Is this SID supported in the current session? Is the service&#160;<br/>supported? Is the format of this request&#160;message correct, i.e. correct length?&#160;Correct&#160;<br/>
&#160;<br/>
data? etc.<br/>
&#160;&#160;<br/>
p&#160;&#160;If any of&#160;these checks fail&#160;a negative response&#160;is sent<br/>
to the tester. Th<br/>
&#160;back&#160;<br/>
e error&#160;<br/>
code&#160;informs&#160;about the reason (e.g. wrong format).&#160;<br/>
&#160;&#160;<br/>
q&#160;&#160;If the incoming&#160;diagnostic request passes&#160;all of these&#160;checks, a PreHandler&#160;function&#160;<br/>
could be called. This PreHandler function&#160;is optional. You have options to set it to&#160;<br/>&lt;none&gt;, &lt;user&gt;&#160;or&#160;&lt;OEM&gt;.&#160;<br/>
&#160;&#160;<br/>
r&#160;&#160;The next function is the MainHandler. This&#160;is a mandatory function.&#160;Every service&#160;<br/>
must provide&#160;a MainHandler. The MainHandler is&#160;designed to analyze the request&#160;<br/>and assemble&#160;the response message. The MainHandler provides&#160;the options&#160;&lt;user&gt;,&#160;<br/>&lt;OEM&gt; and&#160;&lt;generated&gt;.&#160;<br/>
&#160;&#160;<br/>
s&#160;&#160;After the MainHandler&#160;has processed the diagnostic data, provided&#160;the data for the&#160;<br/>
response and&#160;informed the&#160;CANdesc Component about the end of the processing&#160;<br/>(processing done), the positive response&#160;message&#160;will&#160;be sent back to the tester.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The path through the&#160;Transport Protocol and the CAN Driver is not shown&#160;in the&#160;<br/>figure above.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
t&#160;&#160;After the diagnostic response is&#160;sent by the transport layer (ACK)<b>…</b>&#160;<br/>
&#160;&#160;<br/>
u&#160;&#160;<b>…</b>the call of the PostHandler function&#160;is&#160;triggered. This&#160;function&#160;is optional too and&#160;<br/>
- 22 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=23></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-23_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-23_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-23_3.png"/><br/>
User Manual CANdesc &#160;<br/>
Basic Information&#160;<br/>
can be&#160;set to &lt;none&gt;, &lt;user&gt; and &lt;OEM&gt;. Use this function&#160;to do any kind of state&#160;<br/>updates.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;A typical example for&#160;the&#160;<b>PostHandler</b>&#160;is&#160;to reset the CPU to start the&#160;<br/>bootloader.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>3.7.5&#160;&#160;User, None, OEM,&#160;Generated – what does this mean?&#160;</b><br/>
&#160;<br/>
As you have read in the section above,&#160;a Pre-, Main-&#160;and PostHandler can be&#160;<br/>selected for any service to process the diagnostic&#160;service in a very user-friendly&#160;<br/>manner.&#160;<br/>
&#160;&#160;<br/>All handlers&#160;can be&#160;<br/>defined via CANdela&#160;&#160;<b>Handler&#160;</b><br/>
<b>Selectable settings&#160;</b><br/>
Studio&#160;<br/>&#160;<br/>
PreHandler&#160;<br/>
none, user, OEM&#160;<br/>
&#160;<br/>
MainHandler&#160;<br/>
user, OEM, generated&#160;<br/>
&#160;<br/>
PostHandler&#160;<br/>
none, user, OEM&#160;<br/>
&#160;&#160;<br/>
None&#160;<br/>
None can be&#160;selected for Pre and PostHandlers only because these handlers are&#160;<br/>optional. As the name&#160;says, none&#160;switches the handler off.&#160;<br/>
&#160;&#160;<br/>
er&#160;<br/>
Us<br/>
The setting user means that you have to do the complete code for this handler. The&#160;<br/>function prototype is generated in appdesc.h.&#160;<br/>
&#160;&#160;<br/>
OEM (predefined)&#160;<br/>
The setting&#160;OEM handles&#160;the request as required by the car manufacturer. The&#160;<br/>implemen&#160;tion is pa<br/>
ta<br/>
rt of the CANbedded Software Component. The user does&#160;not&#160;<br/>
have to add anything.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The setting OEM should only be used if it is predefined.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Generated&#160;<br/>
If&#160;you select&#160;<b>Generated</b>&#160;you&#160;have two&#160;options&#160;for this handler&#160;(MainHandler)&#160;<br/>
(Signal Handler)&#160;<br/>
1.&#160;&#160;Generate a function prototype (appdesc.h). Use this function&#160;to handle the&#160;<br/>
diagnostic data by returning the current&#160;value (reading&#160;service)&#160;or&#160;using the&#160;<br/>parameter&#160;(writing service). &#160;<br/>
2. In&#160;<br/>
CANdela Studio&#160;you can&#160;enter the name of&#160;the variable. In appdesc.h the&#160;<br/>
external decl<br/>
his variable is<br/>
aration of t<br/>
&#160;generated and&#160;you only need to define this&#160;<br/>
variable in your application&#160;and that’s all.&#160;Your application now just has to keep&#160;<br/>the content up to date.&#160;<br/>
&#160;&#160;<br/>
<b>Cross reference:&#160;</b>For more details about the using the handlers and how to make the&#160;<br/>settings in&#160;CANdela&#160;refer to&#160;STEP Functional&#160;Connection between&#160;your Application&#160;<br/>
&#160;<br/>
and CANdesc/CANdela Studio&#160;on page&#160;35.&#160;<br/>
&#160;<br/>&#160;<br/>&#160;<br/>&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 23 -&#160;<br/>
<hr/>
<a name=24></a>A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>4 A&#160;</b><br/>
<b>Few&#160;</b><br/>
<b>STEPS&#160;to CANdesc&#160;</b><br/>
<b>In this chapter&#160;you find the following&#160;information:&#160;</b><br/>
4.1&#160;<br/>
STEP What do you need before start?&#160;&#160;<br/>
page&#160;<br/>
25<br/>
4.2&#160;<br/>
Startup Code&#160;<br/>
&#160;page&#160;25<br/>
4.3&#160;<br/>
Overview&#160;<br/>
25<br/>
&#160;page&#160;<br/>
4.4&#160;<br/>
STEP Installation&#160;<br/>
&#160;page&#160;26<br/>
4.5&#160;<br/>
STEP Configuration&#160;<br/>
e Gen<br/>
with th<br/>
eration&#160;Tool&#160;&#160;<br/>
page&#160;<br/>
26<br/>
&#160;<br/>
Using the Generation Tool&#160;CANgen&#160;<br/>
&#160;<br/>
Using the Generation Tool&#160;GENy&#160;<br/>
4.6&#160;<br/>
STEP Generating&#160;Files<br/>
page&#160;<br/>
29<br/>
&#160;&#160;<br/>
&#160;<br/>
Using Generation Tool CANgen&#160;<br/>
&#160;<br/>
Using the Generation Tool&#160;GENy&#160;<br/>
4.7&#160;<br/>
STEP Add CANbedded to&#160;<br/>
r Proje<br/>
you<br/>
ct&#160;&#160;<br/>
page&#160;<br/>
32<br/>
4.8&#160;<br/>
STEP Adapt Your Application Files<br/>
&#160;<br/>
33<br/>
&#160;&#160;<br/>
page<br/>
&#160;<br/>
Including, Initializing and Cyclic Calling&#160;<br/>
4.9&#160;<br/>
STEP Functional Connection between your&#160;Application and CANdesc/CANdela&#160;Studio&#160;&#160;<br/>
page&#160;<br/>
35<br/>
&#160;<br/>
How to handle User-Defined Handlers&#160;<br/>
&#160;<br/>
How to Handle&#160;Predefined&#160;Handlers (for&#160;MainHandler&#160;only)&#160;<br/>
&#160;<br/>
Handling OEM-Specific Settings&#160;<br/>
4.10&#160;&#160;STEP Compile and link your Project&#160;&#160;<br/>
page&#160;<br/>
41<br/>
4.11&#160;&#160;STEP Test&#160;it&#160;via&#160;CANoe<br/>
&#160;<br/>
&#160;&#160;page&#160;<br/>
41<br/>
&#160;<br/>
Start CANoe.CAN OSEK TP enlarged&#160;<br/>
&#160;<br/>
Test of CANdesc&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
- 24 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=25></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-25_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-25_2.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
<b>4.1&#160;</b><br/>
<b>STEP&#160;What do you need&#160;before start?&#160;</b><br/>
Check before&#160;you&#160;<br/>
Before you start make sure<br/>
&#160;<br/>
&#160;that&#160;you have received everything you&#160;need.&#160;<br/>
start&#160;<br/>&#160;&#160;<br/>
edd<br/>
CANb<br/>
ed&#160;<br/>
d<br/>
Did you get the CANbed&#160;ed delivery?&#160;<br/>
&#160;&#160;<br/>
YES? Then go on&#160;<br/>
Except for the converter, you should answer all other questions&#160;with&#160;<b>yes&#160;</b>before going&#160;<br/>on here.&#160;<br/>
&#160;&#160;<br/>
<b>.2&#160;</b><br/>
<b>4</b><br/>
<b>Startup Code&#160;</b><br/>
It is&#160;yo<br/>
&#160;<br/>
ur&#160;<br/>
The&#160;<b>startup code</b>&#160;of the microcontroller is not part of the Vector&#160;delivery. The&#160;<b>startup&#160;</b><br/>
responsibility&#160;<br/>
<b>code</b>&#160;complete&#160;is in your responsibility. &#160;<br/>
Take&#160;care to provide an appropriate&#160;<b>startup code</b>&#160;regarding e.g. wait states, etc. &#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The&#160;<b>startup code</b>&#160;is&#160;not part of the Vector delivery.&#160;<br/>
&#160;<br/>
&#160;<br/>
<b>4.3&#160;</b><br/>
<b>Overview&#160;</b><br/>
Step overview&#160;<br/>
This overview show<br/>
steps to CA<br/>
s the&#160;<br/>
Ndesc. These steps are described in detail&#160;on&#160;<br/>
ing s<br/>
the follow<br/>
ections.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 25 -&#160;<br/>
<hr/>
<a name=26></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-26_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-26_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-26_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-26_4.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-26_5.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-26_6.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-26_7.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>4.4&#160;</b><br/>
<b>STEP&#160;Installation&#160;</b><br/>
As you see in&#160;the picture before, you need 2 PC tools to work with&#160;CANbedded&#160;<br/>containing&#160;CANdesc as&#160;a&#160;diagnostic component.&#160;<br/>
&#160;&#160;<br/>
Generation Tool&#160;<br/>
The first tool is&#160;the generation tool. It&#160;<br/>
delivered&#160;<br/>
is&#160;<br/>
with the CANbedded Software&#160;<br/>
Components.&#160;Extract the files to an appropriate folder&#160;and follow the installation&#160;<br/>instructions.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;There are two&#160;kinds of generation&#160;tools,&#160;CANgen&#160;and&#160;GENy.&#160;Which of them you&#160;<br/>have to use depends on&#160;the delivery. In the following steps the usage of both tools&#160;<br/>
&#160;<br/>
are shown.&#160;<br/>
&#160;&#160;<br/>
CANdela Studio&#160;<br/>
The second&#160;PC tool is&#160;CANdela Studio. This&#160;tool is&#160;for editing the&#160;*.CDD file. Install&#160;<br/>the tool by following&#160;the installation instructions.&#160;<br/>
&#160;<br/>
edde<br/>
Extract CANb<br/>
d&#160;<br/>
The number&#160;of CANbedded components in your delivery depends on your project.&#160;&#160;<br/>
ftware&#160;<br/>
So<br/>
To use&#160;CANdesc you need&#160;at least a&#160;<b>CAN Driver</b>&#160;and a&#160;<b>Transport Protocol</b>&#160;(e.g.&#160;<br/>
Components&#160;<br/>
OSEK / ISO&#160;15765-2). &#160;<br/>
Copy all C and H files which are necessary&#160;for the components into your application&#160;<br/>project folder. &#160;<br/>
&#160;&#160;<br/>
<b>Cross reference:</b>&#160;Refer to&#160;the corresponding user&#160;manuals (e.g.&#160;CANDriver User&#160;<br/>Manual) to get further information about the files of the different Software&#160;<br/>
&#160;<br/>
Components.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Since CANdesc is&#160;totally generated, you&#160;won’t find any source files for CANdesc&#160;<br/>in your delivery.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>4.5&#160;</b><br/>
<b>STEP&#160;Configuration with the Generation Tool&#160;</b><br/>
As described&#160;above there are two generation tools for&#160;configuring the CANbedded&#160;<br/>Software Components,&#160;CANgen&#160;and&#160;GENy. &#160;<br/>
&#160;<br/>
In the following&#160;chapters we describe the handling of both tools, beginning&#160;with&#160;<br/>
&#160;<br/>
en<br/>
CANg<br/>
. Figure out which&#160;tool you use&#160;and read the&#160;corresponding&#160;chapters only.&#160;<br/>
&#160;&#160;<br/>
<b>4.5.1&#160;</b><br/>
<b>&#160;the G</b><br/>
<b>Using</b><br/>
<b>eneration Tool CANgen&#160;</b><br/>
&#160;<br/>
Open&#160;CANgen. Add a data&#160;base (DBC&#160;file) via the green plus&#160;<br/>
.&#160;<br/>
&#160;<br/>
<b>Info:</b>&#160;Normally&#160;you get a data base (DBC) from&#160;your&#160;vehicle manufacturer&#160;that is&#160;<br/>designed for your project.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Are the files&#160;<br/>
Make all the&#160;component settings as&#160;described in the&#160;appropriate User Manuals. For&#160;<br/>
generated in the&#160;<br/>
the Transport&#160;Protocol use&#160;the default&#160;<b>[Set Defaults]</b>&#160;for the first attempt.&#160;<br/>
- 26 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=27></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-27_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-27_2.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-27_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-27_4.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
correct path?&#160;<br/>&#160;&#160;<br/>
<b>Info:</b>&#160;Remember to set the paths&#160;where the generation&#160;tool does the&#160;output.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
To configure CANdesc, open the&#160;<b>CANdesc options</b>&#160;tab. For this&#160;first attempt click&#160;<br/><b>[Set Defaults]</b>. The generation tool needs to read&#160;an additional data&#160;base, the&#160;<br/>
&#160;<br/>
CANdela data base (CDD file). Browse for&#160;the CANdela data base file and select the&#160;<br/>
&#160;<br/>
CDD file you received from&#160;your vehicle&#160;manufacturer.&#160;<br/>
Very few settings&#160;<br/>have to be made in&#160;<br/>the Generation&#160;Tool&#160;<br/>CANgen for&#160;<br/>CANdesc&#160;<br/>
If the two checkboxes&#160;for debugging are&#160;checked you&#160;have to provide debug callback&#160;<br/>functions in your application.&#160;<br/>
A very important entry is the Call Cycle.&#160;This&#160;call cycle must be the&#160;one you call&#160;the&#160;<br/>DescTask function or the&#160;DescTimerTask function in your&#160;application (this&#160;will be&#160;<br/>explained in&#160;detail in the next steps).&#160;<br/>
&#160;&#160;<br/>
<b>4.5.2&#160;&#160;Using the Generation Tool GENy&#160;</b><br/>
&#160;<br/>
Open the generation tool&#160;GENy&#160;and create a new project as described in the&#160;<br/>OnlineHelp of&#160;GENy&#160;in the chapter&#160;<b>First Steps</b>.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Normally&#160;you get a data base (DBC) from&#160;your&#160;vehicle manufacturer&#160;that is&#160;<br/>designed for your project.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Make all the&#160;<br/>
one<br/>
comp<br/>
nt settings as&#160;described in the&#160;appropriate User Manuals. &#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Remember to set the paths&#160;where the generation&#160;tool does the&#160;output.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 27 -&#160;<br/>
<hr/>
<a name=28></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-28_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-28_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-28_3.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
&#160;<br/>
Activate the component CANdesc in the component selection view.&#160;<br/>
&#160;&#160;<br/>&#160;<br/>&#160;<br/>
Component&#160;<br/>
ie<br/>
Selection V&#160;w&#160;of&#160;<br/>GENy&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
The activation&#160;of the CANdesc component is modified&#160;with the&#160;<br/>Diag_CANdesc_xxx.DLL version 3.0.&#160;<br/>
&#160;&#160;<br/>
mp<br/>
Co<br/>
onent&#160;<br/>
Selection View&#160;of&#160;<br/>GENy with separate&#160;<br/>CANdesc_Connector<br/>CAN component&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Starting with this version&#160;<br/>
sc&#160;<br/>
CANde<br/>
can&#160;be connected&#160;to more than&#160;one channel or&#160;<br/>
can be used&#160;standalone. The Diag _CANdesc_UDS/KWP component includes&#160;the&#160;<br/>main configuration window&#160;of CANdesc. The Diag_CANdesc_Conn<br/>
N<br/>
ectorCA&#160;&#160;<br/>
component connects&#160;CANdesc to&#160;a CAN network and configures&#160;the TPMC to&#160;work&#160;<br/>with CANdesc.&#160;<br/>
&#160;&#160;<br/>
<b>Caution:</b>&#160;If you do not activate CANdesc_ConnectorCAN component CANdesc will&#160;<br/>generate successful as&#160;standalone CANdesc.&#160;Therefore it is necessary to connect&#160;<br/>
&#160;<br/>
CANdesc with the CANdesc_ConnectorCAN&#160;component to a channel, if the TPMC&#160;<br/>shall be&#160;used.&#160;<br/>
&#160;&#160;<br/>
- 28 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=29></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-29_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-29_2.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
GENy Configuration&#160;<br/>View for CANdesc&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
To configure CANdesc, open the&#160;<b>CANdesc</b>&#160;configuration via the&#160;<br/>Diag_CANde<br/>
view.&#160;<br/>
sc_UDS in the navigation&#160;<br/>
As you see in the figure above, the&#160;<br/>
generation tool needs to read an additional data base, the CANdela data base (CDD&#160;<br/>file). Browse for the CANdela data base file&#160;and select the CDD file you received&#160;from&#160;<br/>your vehicle manufacturer.&#160;<br/>
If the&#160;two checkboxes&#160;for&#160;<br/>
<b>rt</b><br/>
<b>Debug Suppo&#160;</b>&#160;are&#160;checked you have to provide debug&#160;<br/>
callback functions in your&#160;a&#160;plication.&#160;<br/>
p<br/>
A very important entry is the Call Cycle (“Cycle Time”). This call&#160;<br/>
&#160;th<br/>
cycle must be<br/>
e&#160;<br/>
one you call the DescTask&#160;function or&#160;your DescTimerTask function&#160;in your&#160;<br/>application (this will be explained in detail in the next steps).&#160;<br/>
&#160;&#160;<br/>
<b>4.6&#160;</b><br/>
<b>STEP</b><br/>
<b>n</b><br/>
<b>&#160;Ge&#160;erating Files&#160;</b><br/>
<b>.6.1&#160;</b><br/>
<b>4</b><br/>
<b>Using Generation Tool CANgen&#160;</b><br/>
&#160;<br/>
If you have finished the settings in the previous&#160;step,&#160;hit the&#160;<b>[Generate]</b>&#160;<br/>
&#160;button.&#160;<br/>
You get a message box containing information about the generation process and a&#160;<br/><b>[Success]</b>&#160;window containing information about&#160;the generated files and their paths.&#160;<br/>Check to see&#160;if the files are&#160;generated into the correct folders.&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 29 -&#160;<br/>
<hr/>
<a name=30></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-30_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-30_2.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
Success Window&#160;<br/>after a Generation&#160;<br/>Process&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Open the folder you generated in the files listed above. There you&#160;should find the&#160;<br/>generated files for CANdesc, too. These are:&#160;<br/>
&#160;&#160;<br/>
desc.c &#160;<br/>
This file contains the implementation and&#160;the private&#160;interface of the Diagnostic&#160;<br/>Software Component.&#160;<br/>
&#160;<br/>&#160;&#160;<br/>
This file contains the public&#160;interface&#160;of&#160;CANdesc. You will also find the &lt;Negative&#160;<br/>
esc.h&#160;<br/>
d<br/>
response codes&gt;&#160;here.&#160;<br/>
&#160;&#160;<br/>
appdesc.c&#160;<br/>
This file is an&#160;implementation example&#160;for the proper usage of the diagnostics&#160;<br/>callback func<br/>
s. All nece<br/>
tion<br/>
ssary callback functions are generated in&#160;this file and&#160;<br/>
commented&#160;what is left to be done (&lt;&lt;TBD&gt;&gt;). See the example below:&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;Extract of the Generated Callback Functions Template.&#160;<br/>
&#160;<br/>
- 30 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=31></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-31_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-31_2.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
/* ********************************************************************************<br/>
* Function&#160;name:ApplDescReadVoltageService_Instance_For_Demonstration_Purposes<br/>* Description:&#160;Reads a&#160;signal.<br/>* Returns:&#160;signal value<br/>* Parameter(s):&#160;none<br/>* Particularitie(s)&#160;and limitation(s):<br/>* &#160;&#160;-&#160;The function&#160;&#34;DescProcessingDone&#34;&#160;may&#160;not&#160;be&#160;called.<br/>* &#160;&#160;-&#160;The function&#160;&#34;DescSetNegResponse&#34;&#160;may&#160;not&#160;be&#160;called.<br/>********************************************************************************&#160;*/<br/>
vuint8 DESC_API_CALLBACK_TYPE&#160;<br/>
<b>ApplDescReadVoltageService_Instance_For_Demonstration_Purposes</b>(void)<br/>
{<br/>
/*&lt;&lt;TBD&gt;&gt;&#160;Remove&#160;this&#160;comment once you&#160;have&#160;completely&#160;implemented this&#160;function!!!*/<br/>/*Return the signal value.*/<br/><b>return&#160;</b>0xFF;<br/>
}<br/>
/* ********************************************************************************<br/>
* Function&#160;name:ApplDescReadCurrentService_Instance_For_Demonstration_Purposes<br/>* Description:&#160;Reads a&#160;signal.<br/>* Returns:&#160;signal value<br/>* Parameter(s):&#160;none<br/>* Particularitie(s)&#160;and limitation(s):<br/>* &#160;&#160;-&#160;The function&#160;&#34;DescProcessingDone&#34;&#160;may&#160;not&#160;be&#160;called.<br/>* &#160;&#160;-&#160;The function&#160;&#34;DescSetNegResponse&#34;&#160;may&#160;not&#160;be&#160;called.<br/>********************************************************************************&#160;*/<br/>
vuint8 DESC_API_CALLBACK_TYPE&#160;<br/>
<b>ApplDescReadCurrentService_Instance_For_Demonstration_Purposes</b>(void)<br/>
{<br/>
/*&lt;&lt;TBD&gt;&gt;&#160;Remove&#160;this&#160;comment once you&#160;have&#160;completely&#160;implemented this&#160;function!!!*/<br/>/*Return the signal value.*/<br/><b>return&#160;</b>0xFF;<br/>
}<br/>
/* ********************************************************************************<br/>
* Function&#160;name:ApplDescReadResistanceService_Instance_For_Demonstration_Purposes<br/>* Description:&#160;Reads a&#160;signal.<br/>* Returns:&#160;signal value<br/>* Parameter(s):&#160;none<br/>* Particularitie(s)&#160;and limitation(s):<br/>* &#160;&#160;-&#160;The function&#160;&#34;DescProcessingDone&#34;&#160;may&#160;not&#160;be&#160;called.<br/>* &#160;&#160;-&#160;The function&#160;&#34;DescSetNegResponse&#34;&#160;may&#160;not&#160;be&#160;called.<br/>********************************************************************************&#160;*/<br/>
vuint16 DESC_API_CALLBA<br/>
YPE<br/>
CK_T<br/>
&#160;<br/>
<b>ApplDescReadResistanceService_Instance_For_Demonstration_Purposes</b>(void)<br/>
{<br/>
/*&lt;&lt;TBD&gt;&gt;&#160;Remove&#160;this&#160;comment once you&#160;have&#160;completely&#160;implemented this&#160;functio<br/>
*<br/>
n!!!&#160;/<br/>
/*Return the signal value.*/<br/><b>return&#160;</b>0xFFFF;<br/>
}<br/>
&#160;&#160;<br/>
Appdesc modification &#160;&#160;If you start programming in&#160;the file appdesc.c, you fill in the missing&#160;code for the&#160;<br/>
services&#160;and&#160;<br/>
ne<br/>
you start a&#160;<br/>
w generation process, the&#160;generation tool detects&#160;whether&#160;<br/>
Detection to prevent&#160;<br/>
the file has been chan<br/>
d&#160;<br/>
ge&#160;or not:&#160;<br/>
loss&#160;of&#160;changes&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;So better rename the file before you implement&#160;the diagnostic&#160;services.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
appdesc.h&#160;<br/>
This file provides prototypes&#160;of the&#160;application diagnostic callback functions and&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 31 -&#160;<br/>
<hr/>
<a name=32></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-32_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-32_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-32_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-32_4.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-32_5.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-32_6.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-32_7.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
external application declarations, which are accessed&#160;by CANdesc.&#160;<br/>
All callback function&#160;<br/>prototypes&#160;are&#160;<br/>generated&#160;in&#160;<br/>appdesc.h.&#160;<br/>&#160;&#160;<br/>
Appdescdev.c&#160;<br/>
This file contains the definition of the used variables in&#160;CANdela Studio. &#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;This&#160;file&#160;shall&#160;be&#160;used only during&#160;the&#160;first&#160;integration in&#160;order to&#160;make&#160;your&#160;<br/>project fully compile- and linkable. This&#160;file is no&#160;necessary later, since the variables&#160;<br/>
&#160;<br/>
that will be defined here shall be implemented within&#160;your ECU application&#160;code.&#160;<br/>
&#160;&#160;<br/>
<b>Cross reference:&#160;</b>(see section&#160;How to Handle Predefined Handlers (for MainHandler&#160;<br/>only)&#160;on page&#160;38)&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>4.6.2&#160;&#160;Using the Generation Tool GENy&#160;</b><br/>
&#160;<br/>
If you have finished the settings in the pr<br/>
s<br/>
eviou&#160;&#160;step,&#160;hit the&#160;<b>[Generate]</b>&#160;<br/>
&#160;button. &#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;All files&#160;for the CANdesc Software Component are generated!&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Generated Files for&#160;<br/>
In the Genera<br/>
iew you see the f<br/>
ted Files v<br/>
iles listed as&#160;shown in the&#160;figure below.&#160;Use&#160;<br/>
Nd<br/>
CA<br/>
esc –CANdesc&#160;&#160;this output to check the paths. In the list you only see&#160;the CANdesc-relevant files. The&#160;<br/>
Core File<br/>
re&#160;<br/>
s a<br/>
files are the&#160;same as generated with&#160;CANgen, so refer above for de<br/>
ation.&#160;<br/>
tailed inform<br/>
Gene<br/>
o!&#160;<br/>
rated, to<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>4.7&#160;</b><br/>
<b>STEP&#160;Add CANbedded to your Project&#160;</b><br/>
What to do in&#160;this step depends on your&#160;development environment. Perhaps you&#160;are&#160;<br/>working with&#160;a makefile?&#160;<br/>
&#160;<br/>
Regardless of&#160;this you have to add the CANbedded files to your project. These&#160;are&#160;<br/>the files discussed in Section&#160;Extract CANbedded Software&#160;Components&#160;on page&#160;26&#160;<br/>and the ones&#160;generated in the previous&#160;step.&#160;<br/>
&#160;&#160;<br/>
<b>Caution:</b>&#160;Always make sure that the path in which you generate the files and the path&#160;<br/>your compiler is working on&#160;are the same!&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Now there are several adaptations for you to make in&#160;your application.&#160;<br/>
&#160;&#160;<br/>
- 32 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=33></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-33_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-33_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-33_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-33_4.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
<b>4.8&#160;</b><br/>
<b>STEP&#160;Adapt Your Application Files&#160;</b><br/>
Now all files for CANbedded and CANdesc are included in your project, and we can&#160;<br/>go on to make the necessary adaptations in your application files.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
These adaptations can be&#160;split in two categories:&#160;<br/>¼&#160;&#160;Include, initialize and make&#160;the cyclic&#160;calls for the CANbedded Software&#160;<br/>
Components&#160;(use the component-specific documentation for details).&#160;<br/>
¼&#160;&#160;Connect your application to CANdesc&#160;<br/>
&#160;&#160;<br/>
<b>4.8.1&#160;&#160;Including, Initializing and Cyclic Calling&#160;</b><br/>
Two CANdesc&#160;<br/>
As for all other CANbedded&#160;Components,&#160;CANdesc must be included, initialized&#160;and&#160;<br/>
headers have&#160;to be&#160;<br/>
used via a cyclic&#160;call.&#160;<br/>
included in your&#160;<br/>application:&#160;<br/>
desc.h&#160;<br/>
appdesc.h&#160;<br/>
&#160;<br/>
Keep the including&#160;<br/>file structure.&#160;<br/>
The figure shows all generated files of&#160;CANdesc. Your&#160;application&#160;only needs to&#160;<br/>include the files desc.h and appdesc.h in&#160;the order they are mentioned.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Any User Manual dealing with our CANbedded Software&#160;Components shows&#160;<br/>this kind of illustration. Always keep the&#160;include file structure that is&#160;shown.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Like all other&#160;<br/>
As for all other CANbedded&#160;Software Components the&#160;initialization function&#160;follows&#160;<br/>
CANbedded&#160;<br/>
the same naming conventions. For CANdesc use:&#160;<br/>
Software&#160;<br/>
DescInitPowerOn( initParameter );&#160;<br/>
Components,&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
/*Interrupts must be disabled*/&#160;<br/>
CANdesc must be&#160;<br/>initialized and the&#160;<br/>Interrupts&#160;must&#160;be&#160;<br/>disabled during&#160;<br/>initialization&#160;<br/>&#160;&#160;<br/>
<b>Cross reference:</b>&#160;For information about the initParameter &#160;refer to your OEM-specific&#160;<br/>Technical Reference for CANdesc.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Make&#160;sure that DescInitPowerOn is&#160;called after the call of CanInitPowerOn and&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 33 -&#160;<br/>
<hr/>
<a name=34></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-34_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-34_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-34_3.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
TpInitPowerOn. &#160;<br/>
Normally the components&#160;are initialized&#160;from the bottom up according to the layer&#160;<br/>model. Always&#160;do these initializations&#160;with disabled interrupts.&#160;<br/>
This is the correct order of&#160;initialization&#160;if&#160;you use CAN Driver, Transport Protocol and&#160;<br/>CANdesc.&#160;<br/>
1. CanInitPowerOn();&#160;<br/>
2. TpInitPowerOn();&#160;<br/>
3. DescInitPowerOn(0);&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
As you adjusted things&#160;in&#160;Using the Generation Tool&#160;CANgen&#160;on page&#160;26&#160;(<b>Call cycle&#160;<br/>for CANdescMain</b>) the components need a cyclic&#160;call in your application to work&#160;<br/>properly. The&#160;call cycle must be the same&#160;as entered&#160;on the CANdesc tab / view&#160;<br/>(CANgen&#160;/&#160;GENy). The functions&#160;to call cyclically are:&#160;<br/>
&#160;&#160;<br/>
It is&#160;very important&#160;<br/>
DescTask( ); or&#160;<br/>
that you call&#160;<br/>
ther with DescStateTask)&#160;<br/>
DescTimerTask(); (toge<br/>
DescTask( )&#160;or&#160;<br/>DescTimerTask()&#160;<br/>
c<br/>
cycli&#160;ally and&#160;keep&#160;<br/>the adjusted&#160;call&#160;<br/>
cle&#160;<br/>
cy<br/>&#160;&#160;<br/>
<b>Caution:</b>&#160;Never use DescTask() and&#160;DescTimerTask() / DescStateTask() together!&#160;<br/>
&#160;<br/>
&#160;<br/>
Using&#160;DescTask&#160;<br/>
With the call&#160;of this single function&#160;the handling of the timers and of the internal&#160;<br/>service processing (including application functions) is&#160;triggered. If&#160;you receive a&#160;<br/>diagnostic request, the response can be&#160;handled&#160;not until the next call of DescTask. &#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;This&#160;could lead to slower&#160;service processing.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Using&#160;<br/>
This&#160;concept&#160;splits the timer handling for&#160;CANdesc from&#160;the internal&#160;service&#160;<br/>
scTimerTask<br/>
De<br/>
&#160;<br/>
processing. Now only the function&#160;DescTimerTa<br/>
has to be&#160;<br/>
sk()&#160;<br/>
called in the predefined&#160;<br/>
and&#160;<br/>
(configuration tool) cycle time. &#160;<br/>
DescStateTask&#160;<br/>
The function DescStateTask() has&#160;to be call<br/>
cyclic ma<br/>
ed in a&#160;<br/>
nner too, but does not&#160;<br/>
need a fix cycle time. It can be called very fast to speed-up the&#160;reaction on a&#160;<br/>diagnostic request or it can be called as&#160;soon as&#160;there are free resources&#160;(e.g. an idle&#160;<br/>task in an operating&#160;system).&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;CANdesc and DescTimerTask use&#160;the cyclic&#160;call&#160;as a time base for the timing&#160;<br/>calculations.&#160;<br/>
&#160;<br/>
Do not make&#160;this&#160;call out of a timer interrupt. Just&#160;call DescTask() or&#160;<br/>DescTimerTask() at the task level.&#160;<br/>
&#160;&#160;<br/>
- 34 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=35></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-35_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-35_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-35_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-35_4.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-35_5.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
<b>4.9&#160;&#160;STEP&#160;Functional Connection between your Application and&#160;</b><br/>
<b>CANdesc/CANdela Studio&#160;</b><br/>
&#160;<br/>
It is up to you when you perform this&#160;step: before&#160;STEP Configuration with the&#160;<br/>Generation Tool&#160;(page&#160;26), as a part of&#160;STEP Adapt Your Application Files&#160;(page&#160;33)&#160;<br/>or perhaps at&#160;both times.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;There is&#160;a very close&#160;connection between the settings in&#160;CANdela Studio&#160;and&#160;<br/>what to do in&#160;your application.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Have a look&#160;a&#160;look at section&#160;Generic&#160;Handling of a Diagnostic&#160;Request in the&#160;<br/>CANdesc Component&#160;on page&#160;21.&#160;<br/>
&#160;<br/>
As you can&#160;see, there are&#160;three types of&#160;handlers&#160;(Pre-, Main- and&#160;PostHandler) that&#160;<br/>can be selected for any service. It is very&#160;important to know&#160;what happens when&#160;you&#160;<br/>choose the&#160;<b>Value</b><br/>
he h<br/>
&#160;for t<br/>
andlers. For this decision you need an overview of the&#160;<br/>
great flexibility arising&#160;with the choice.&#160;<br/>
We will first go&#160;through the&#160;possible&#160;settings for&#160;one service as&#160;an&#160;example. With&#160;the&#160;<br/>knowledge you gain from this you can then go on&#160;with&#160;the other services.&#160;<br/>
The settings&#160;of the handlers value can be&#160;made in the&#160;Properties&#160;windows of each&#160;<br/>service on the&#160;<br/>
&#160;tab (see value<br/>
<b>Attributes</b><br/>
s&#160;in the following figure).&#160;<br/>
&#160;&#160;<br/>
How are the&#160;settings&#160;<br/>in CANdela&#160;&#160;appe<br/>
m<br/>
d&#160;<br/>
to your application?&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
Support for the&#160;<br/>different Handlers&#160;<br/>can be adjusted on&#160;<br/>the Service Property&#160;<br/>Page&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>4.9.1&#160;</b><br/>
<b>ow</b><br/>
<b>H</b><br/>
<b>&#160;to handle User-Defined Handlers&#160;</b><br/>
If you choose&#160;for the handlers to be user-defined, you have to do all&#160;the programming&#160;<br/>work for this&#160;service yourself, except for&#160;the checks. A callback function prototype will&#160;<br/>be generated&#160;in the file appdesc.h.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Service Qualifier&#160;<br/>
Open the Service Properties&#160;and then&#160;the&#160;<b>General</b>&#160;tab.&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 35 -&#160;<br/>
<hr/>
<a name=36></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-36_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-36_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-36_3.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Diagnostic Instance&#160;<br/>
Open the&#160;Diagnostic Instance Properties and then&#160;the&#160;<b>General</b>&#160;Tab&#160;<br/>
Qualifier&#160;<br/>
&#160;&#160;<br/>
Names&#160;of the&#160;<br/>
The names of&#160;these callback functions are built as the&#160;following &#160;<br/>
generated callback&#160;<br/>
&#160;<br/>
functions&#160;<br/>&#160;&#160;<br/>
<b>Example:</b>&#160;For this example, the callback function&#160;would look&#160;like this:&#160;<br/>
appldesc +&#160;<b>Read</b>&#160;+&#160;<b>Service_Instance_For_Demonstration_Purposes&#160;</b><br/>
&#160;<br/>
appldesc +<b>Pre</b>+&#160;<b>Read</b>&#160;+&#160;<b>Service_Instance_For_Demonstration_Purposes&#160;</b><br/>
appldesc +<b>Post</b>+&#160;<b>Read</b>&#160;+&#160;<b>Service_Instance_For_Demonstration_Purposes</b>&#160;<br/>
with parameters:&#160;<br/>
void ApplDescReadService_Instance_For_Demonstration_Purposes(DescMsgContext* pMsgContext);<br/>
void ApplDesc<b>Pre</b>ReadService_Instance_For_Demonstration_Purposes(void);<br/>
void ApplDesc<b>Post</b>ReadService_Instance_For_Demonstration_Purposes(vuint8 status);<br/>
&#160;&#160;<br/>
&#160;<br/>
Now you have to provide all the prototypes of&#160;the appdesc.h file as&#160;functions in your&#160;<br/>application and do the coding for each service, i.e. for each Pre-, Main- and&#160;<br/>PostHandler that is&#160;switched to User. &#160;<br/>
See an example for a ReadDataByIdentifier MainHandler for the&#160;service above&#160;<br/>
- 36 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=37></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-37_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-37_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-37_3.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
defined for&#160;<b>User</b>. The data&#160;bytes of this service are:&#160;<br/>¼&#160;&#160;g_Voltage (1 Byte)&#160;<br/>¼&#160;&#160;g_Current (1&#160;Byte)&#160;<br/>¼&#160;&#160;g_Resistant (2 Bytes)&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
To process this service by&#160;yourself, you&#160;need to know&#160;how to access the diagnostic&#160;<br/>data. The following&#160;figure&#160;<br/>
w<br/>
sho&#160;s the data access for&#160;a reading service (upper&#160;figure)&#160;<br/>
and a writing&#160;service.&#160;<br/>
A reading service consists&#160;of a SID and perhaps&#160;a Sub-Service. The requested da&#160;&#160;<br/>
ta<br/>
is then sent with the response.&#160;<br/>
A writing service consists&#160;of&#160;a SID, perhaps a Sub-Service and the data. The&#160;<br/>response is&#160;only a confirmation with&#160;SID+0x40 and perhaps&#160;a Sub-Service.&#160;<br/>
When working with CANdesc you only need to&#160;process the data. That is the reason&#160;<br/>why the pointer is directed&#160;to the first data byte. &#160;<br/>
<b>The same Diagnostic&#160;Buffer&#160;is used&#160;for&#160;receiving&#160;a diagnostic request&#160;AND sending&#160;the&#160;response</b><br/>
<b>reqDataLen&#160;=&#160;0</b><br/>
Diagnostic&#160;<b>req</b>uest&#160;(<b>A:&#160;</b>reading service)<br/>
<b>reqData[&#160;0&#160;]</b><br/>
<b>Diagnostic</b><br/>
SID&#160;<br/>
Sub&#160;Service<br/>
-<br/>
-<br/>
-<br/>
<b>Buffer</b><br/>
SID +&#160;0x40<br/>
Sub&#160;Service<br/>
Data<br/>
Data<br/>
Data<br/>
(RAM&#160;Memory)<br/>
resData[&#160;1&#160;]<br/>
resData[&#160;2&#160;]<br/>
Positive Diagnostic&#160;<b>res</b>ponse<br/>
<b>resData[&#160;0&#160;]</b><br/>
<b>resDataLen</b><br/>
<b>reqData[&#160;0&#160;]</b><br/>
<b>reqDataLen</b><br/>
Diagnostic&#160;<b>req</b>uest&#160;(<b>B:&#160;</b>writing&#160;service)<br/>
reqData[&#160;1&#160;]<br/>
reqData[&#160;2&#160;]<br/>
<b>Diagnostic</b><br/>
SID&#160;<br/>
Sub&#160;Service<br/>
Data<br/>
Data<br/>
Data<br/>
<b>Buffer</b><br/>
SID +&#160;0x40<br/>
Sub&#160;Service<br/>
-<br/>
-<br/>
-<br/>
(RAM&#160;Memory)<br/>
Positive&#160;Diagnostic&#160;<b>res</b>ponse<br/>
<b>resData[&#160;0&#160;]</b><br/>
<b>resDataLen&#160;= 0</b><br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The request data and&#160;the response&#160;data are&#160;stored to the same&#160;memory&#160;<br/>location. Writing the response data means deleting the&#160;request data.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;The example below shows a&#160;very easy way to process a diagnostic&#160;<br/>request. The&#160;data is copied&#160;to the&#160;<b>Diagnostic Buffer</b>, the amount&#160;of the response&#160;<br/>
&#160;<br/>
data is determined and the diagnostic service is&#160;finished via DescProcessingDone.&#160;<br/>
&#160;<br/>
Code&#160;Example for&#160;<br/>the MainHandler&#160;<br/>Using the User&#160;<br/>Option&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 37 -&#160;<br/>
<hr/>
<a name=38></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-38_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-38_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-38_3.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>Example:</b>&#160;When preparing the diagnostic response,&#160;it is very important to provide the&#160;<br/>correct data and calculate the length of the response (ÆresDataLen).&#160;&#160;<br/>
&#160;<br/>
To finish the&#160;service processing with&#160;a positive&#160;response,&#160;call:&#160;<br/>
DescProcessingDone(); &#160;<br/>
For a negative response, finish&#160;the&#160;service processing&#160;with:&#160;<br/>
DescSetNegResponse(&lt;errorCode&gt;);&#160;<br/>
DescProcessingDone();&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;A negative response&#160;can also be&#160;set in the PreHandler. There&#160;it is enough to&#160;<br/>call DescSetNegResponse(&lt;errorCode&gt;). The PreHandler&#160;<b>must</b>&#160;<b>not</b>&#160;be finished with&#160;<br/>
&#160;<br/>
DescProcessingDone. See&#160;desc.h for the&#160;definitions of&#160;the erro<br/>
es.&#160;<br/>
r cod<br/>
Remember: in the PreHandlers no access to the diagnostic data buffer is possible.&#160;<br/>
&#160;&#160;<br/>
Response pending&#160;<br/>
What to do if the response&#160;cannot be sent immediately?&#160;<br/>
will be sent&#160;<br/>
In some&#160;cases&#160;(e.g. writing data to the EEPROM) you cannot send the response&#160;<br/>
automatically by&#160;<br/>
immediately, but you need&#160;not treat this&#160;as&#160;an exception. CANdesc will automatically&#160;<br/>
CANdesc&#160;<br/>
inform the tester about the&#160;delay in the diagnostic response. So process the request&#160;<br/>and if you finish it, send&#160;DescProcessingDone. All other timing aspects are realized&#160;<br/>by CANdesc (Response Pending).&#160;<br/>
&#160;&#160;<br/>
<b>4.9.2&#160;&#160;How&#160;to Handle Predefined Handlers (for MainHandler only)&#160;</b><br/>
If&#160;you select&#160;<b>generated</b>&#160;you need not to program the&#160;complete service by hand.&#160;Using&#160;<br/>this option gives you two further options:&#160;<br/>
1.&#160;&#160;A signal callback function&#160;will be generated&#160;<br/>
&#160;&#160;2.&#160;&#160;You can tell&#160;CANdela the&#160;name of the&#160;variable (and data type) for a certain&#160;<br/>
service and you only have&#160;to provide this&#160;variable in your application code.&#160;<br/>
&#160;<br/>
To get a signal callback function generated,&#160;i.e. to implement the first option, right&#160;<br/>click on a data object and&#160;choose Properties from the pull down&#160;menu. Now the&#160;<br/>Properties&#160;window of the chosen data object opens. In this example it is the data&#160;<br/>
c<br/>
obje&#160;t Voltage.&#160;<br/>
&#160;&#160;<br/>
- 38 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=39></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-39_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-39_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-39_3.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
Signal Access via the&#160;<br/>Application and a&#160;<br/>Callback Function&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;Make sure that the&#160;<b>Overwritten Value</b>&#160;field on the&#160;<b>Attributes</b>&#160;tab is&#160;empty.&#160;<br/>The generated&#160;prototype should look like this. &#160;<br/>
&#160;<br/>
vuint8 &#160;<br/>
ApplDescReadVoltageService_Instance_For_Demonstration_Purposes(<br/>void);&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;All you have to do in your application for this&#160;MainHandler is to provide&#160;the&#160;<br/>function ApplDescReadVoltageService_Instance_For_Demonstration_Purposes and&#160;<br/>
&#160;<br/>
return the current value for&#160;the voltage stored anywhere in your application. The data&#160;<br/>type of the return value&#160;will be adjusted automatically to the data type (Element Type)&#160;<br/>in&#160;CANdela Studio. In this&#160;case&#160;it is&#160;a 1 byte value,&#160;therefore it is the data type vuint8.&#160;<br/>
vuint8 &#160;<br/>
oses(<br/>
ApplDescReadVoltageService_Instance_For_Demonstration_Purp<br/>void);&#160;<br/>
{&#160;<br/>
&#160; return g_Voltage;&#160;<br/>
}&#160;<br/>
&#160;&#160;<br/>
Generated does not&#160;<br/>
The second option is to connect the settings in&#160;CANdela Studio&#160;more closely to your&#160;<br/>
mean that you do not&#160;&#160;application. Do the same&#160;steps as&#160;described&#160;above, but now enter&#160;the name of the&#160;<br/>have to do anything&#160;<br/>
variable in the value field of the Attributes tab as&#160;shown in the following figure.&#160;<br/>
– but there is&#160;little&#160;<br/>prog<br/>
m<br/>
ram&#160;ing&#160;work&#160;<br/>
left to do&#160;<br/>&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 39 -&#160;<br/>
<hr/>
<a name=40></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-40_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-40_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-40_3.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
Direct Signal&#160;Access&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;Now an external&#160;declaration of&#160;the&#160;variable g_Voltage prototype should&#160;be&#160;<br/>generated.&#160;<br/>
&#160;<br/>
extern vuint8 g_Voltage;&#160;<br/>
The data type&#160;for this declaration again&#160;depends on&#160;the element type of the data&#160;<br/>object, in this case 1 byte again.&#160;<br/>
Provide g_Voltage in your&#160;application (or use the appdescdev.c) and use it for storing&#160;<br/>the current voltage value. If a diagnostic&#160;request requests this&#160;value, CANdesc&#160;<br/>automatically refers to the content of g_Voltage. There&#160;is nothing more left to do for&#160;<br/>you.&#160;<br/>
&#160;&#160;<br/>
<b>4.9.3&#160;&#160;Handling OEM-Specific Settings&#160;</b><br/>
&#160;<br/>
The third&#160;choice is OEM. Do not change&#160;this. If the setting is on OEM, leave the&#160;<br/>settings as they are and&#160;refer to the OEM-specific documentation&#160;on how to deal with&#160;<br/>this service.&#160;<br/>
Now your task is to implement all diagnostic services&#160;you have to support and select&#160;<br/>the desired&#160;status for Pre-, Main- and PostHandlers&#160;(none, user, OEM, generated).&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Caution:</b>&#160;Do not&#160;touch&#160;the OEM-defined&#160;handlers.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Then save the settings. This will change&#160;the CDD file. Depending&#160;on&#160;which step&#160;you&#160;<br/>are on&#160;right now, either&#160;<br/>
- 40 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=41></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-41_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-41_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-41_3.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
continue with&#160;STEP Configuration&#160;with the Generation&#160;Tool&#160;on page&#160;26&#160;or&#160;<br/>
start the generation process again to generated the files containing&#160;the changes you&#160;<br/>made.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Sometimes in development, not all diagnostic&#160;services&#160;have&#160;been defined&#160;yet by&#160;<br/>the OEM. Provide this function anyway and&#160;send a negative response back. Then&#160;you&#160;<br/>
&#160;<br/>
can&#160;compile and link and test the other functions until the specification of the missing&#160;<br/>services is completed.&#160;<br/>
&#160;&#160;<br/>
<b>4.10&#160;&#160;STEP&#160;Compile and link your Project&#160;</b><br/>
Now we have&#160;all the includes and all initializations. The components have the cyclic&#160;<br/>calls of their task functions&#160;and all callback functions are provided and programmed.&#160;<br/>
&#160;<br/>
Start the compiler or&#160;makefile and get the project compiled and linked. &#160;<br/>
Is it ok? No errors?&#160;<br/>
Congratulations!&#160;That’s&#160;it.&#160;&#160;<br/>
Go on to the next step and&#160;do the testing.&#160;<br/>
&#160;&#160;<br/>
<b>4.11&#160;&#160;STEP&#160;Test it via CANoe&#160;</b><br/>
Since you have arrived at this step, you are now able to compile and&#160;link. Have you&#160;<br/>already downloaded the code to your target platform?&#160;&#160;<br/>
&#160;<br/>
Testing of the&#160;generated CANdesc depends on&#160;you and the OEM you are&#160;working for.&#160;<br/>Perhaps you&#160;do have a diagnostic tester, perhaps not.&#160;&#160;<br/>
If you do&#160;not&#160;have an appropriate tester,&#160;we recommend using&#160;<b>CANoe</b>&#160;(a Vector PC&#160;<br/>tool) and one&#160;of its demo configurations.&#160;<br/>
&#160;&#160;<br/>
<b>4.11.1&#160;&#160;Start CANoe.CAN OSEK TP enlarged&#160;</b><br/>
The CANoe demo&#160;<br/>
To test you diagnostics layer use one of&#160;the CANoe demo applications. Open this&#160;<br/>
environment is&#160;very&#160;<br/>
config<br/>
n via&#160;<br/>
uratio<br/>
<b>Start/Programs/CANoe/Demos/More Demos/CANoe.CAN OSEK&#160;</b><br/>
simple way&#160;to&#160;<br/>
<b>d</b><br/>
<b>TP enlarge&#160;</b>.&#160;<br/>
basically test&#160;<br/>
A CANoe&#160;configuration&#160;will open&#160;with four&#160;nodes (A to&#160;D). All nodes&#160;look quite the&#160;<br/>
requests&#160;and&#160;<br/>
same like&#160;this:&#160;<br/>
responses&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 41 -&#160;<br/>
<hr/>
<a name=42></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-42_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-42_2.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-42_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-42_4.png"/><br/>
A Few STEPS to CANdesc&#160;<br/>
User Manual CANdesc&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Set the baud&#160;rate in CANoe to the one of&#160;your ECU and connect it to CANoe via&#160;CAN&#160;<br/>(CANcardXL, CANAC2…).&#160;Now run CANoe via the yellow lightning bolt and run&#160;<br/>YourECU.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Make&#160;sure that the CANoe mode is&#160;switched to&#160;<b>Real bus</b>&#160;and&#160;you have&#160;<br/>selected the&#160;same baud&#160;rate as the real node “YourECU” is working with.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>4.11.2&#160;&#160;Test of CANdesc&#160;</b><br/>
&#160;<br/>
Use one of the four nodes for your tests.&#160;Change the TpTxId and the&#160;TpRxId in the&#160;<br/>“Addressing”&#160;field of the node window.&#160;<br/>
&#160;&#160;<br/>
<b>Caution:</b>&#160;The&#160;TpTxId is the Rx Diagnostic message in&#160;your generation tool and the&#160;<br/>TpRxId is the&#160;Tx Diagnostic message.&#160;In the example case the DiagResponse&#160;<br/>
&#160;<br/>
message is 0x7C0 and the&#160;DiagRequest&#160;message 0x7B0.&#160;<br/>
It is optional to set the time&#160;for ST Min from&#160;64ms (default) to 20ms. This is to prevent&#160;<br/>the ECU from&#160;running&#160;in time out.&#160;<br/>
&#160;&#160;<br/>
- 42 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=43></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-43_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-43_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-43_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-43_4.png"/><br/>
User Manual CANdesc &#160;<br/>
A Few STEPS to CANdesc&#160;<br/>
Panel to Test&#160;<br/>Diagnostics Layer&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;<br/>
Compare the Values&#160;<br/>with the ones shown&#160;<br/>in CANdela Studio&#160;<br/>
&#160;&#160;Æ...<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
It is&#160;very simple to test&#160;the services&#160;using&#160;CANoe. Enter the request in the&#160;<br/><b>Transmission</b>&#160;box and press&#160;<b>Send Data</b>&#160;and&#160;see the response in&#160;the same box.&#160;<br/>Compare this response with the desired&#160;one in&#160;CANdela Studio. The contents of&#160;the&#160;<br/>signals depend on the application.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Make&#160;some variations&#160;to the signal&#160;contents to confirm the tests.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Repeat this for all other services.&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 43 -&#160;<br/>
<hr/>
<a name=44></a>Further Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>5 Further&#160;</b><br/>
<b>Information&#160;</b><br/>
<b>In this chapter&#160;you find the following&#160;information:&#160;</b><br/>
5.1&#160;<br/>
Diagnostic State Handling&#160;using CANdela Studio&#160;&#160;<br/>
page&#160;<br/>
45<br/>
5.2&#160;<br/>
Typical Examples of State Groups and&#160;States in an&#160;Automotive Environment&#160;&#160;<br/>
page&#160;<br/>
45<br/>
5.3&#160;<br/>
Creating and editing State Groups, States and Transitions&#160;&#160;<br/>
page&#160;<br/>
45<br/>
5.4&#160;<br/>
Connection between the states and your application&#160;&#160;<br/>
page&#160;<br/>
47<br/>
5.5&#160;<br/>
Diagnostic Buffer&#160;<br/>
&#160;page&#160;48<br/>
&#160;<br/>
Linear Diagnostic Buffer&#160;<br/>
&#160;<br/>
Ring Buffer Mechanism&#160;<br/>
5.6&#160;<br/>
Repeated Service Call Feature&#160;&#160;<br/>
page&#160;<br/>
55<br/>
&#160;<br/>
Activation of the Repeated&#160;Service&#160;Call&#160;<br/>
&#160;<br/>
Repeated Service Call and&#160;Ring Buffer 1&#160;– “Write and&#160;Check”&#160;<br/>
&#160;<br/>
Repeated Service Call and&#160;Ring Buffer 2&#160;– “Check and Write”&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
- 44 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=45></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-45_1.png"/><br/>
User Manual CANdesc &#160;<br/>
Further Information&#160;<br/>
<b>5.1&#160;&#160;Diagnostic State Handling using CANdela Studio&#160;</b><br/>
&#160;<br/>
Executing a diagnostic&#160;service generally&#160;causes&#160;a state change in the electronic&#160;<br/>control unit. Some services may only be executed&#160;if the electronic control unit is in&#160;a&#160;<br/>particular state. For example, services that change critical data may&#160;only be executed&#160;<br/>if the electronic control unit&#160;is first switched into a “security mode”&#160;(for example with&#160;<br/>the specification of a numeric&#160;key). &#160;<br/>
CANdela Studio&#160;offers the&#160;opportunity to define&#160;and edit global states and state&#160;<br/>transitions for the services&#160;of a diagnostic&#160;instance. In addition, states can be&#160;<br/>combined into state groups.&#160;<br/>
&#160;&#160;<br/>
<b>5.2&#160;&#160;Typical Examples of State Groups&#160;and States in an Automotive&#160;<br/>Environment&#160;</b><br/>
&#160;<br/>
The sessions&#160;(which should already be predefined) are a very “famous” example of a&#160;<br/>state group.&#160;Any diagnostic session has its set of services that are&#160;executable while&#160;<br/>the ECU is in&#160;this session.&#160;There are basically three sessions, defined from the ISO:&#160;<br/>¼&#160;&#160;Default session – as the name says, this&#160;is&#160;the standard session&#160;<br/>¼&#160;&#160;Programming&#160;session – while the ECU is&#160;in reprogramming mode&#160;(flashing)&#160;<br/>¼&#160;&#160;Extended Session – session for e.g.&#160;the development phase, providing an&#160;<br/>
extended amount of services&#160;<br/>
Another very&#160;easy example for state groups is the security access. The ECU must be&#160;<br/>set to a specific state to be&#160;able to do critical data manipulation,&#160;su<br/>
s<br/>
ch a&#160;&#160;the flashing&#160;<br/>
action mentioned above. For example, the states&#160;for the state group security access&#160;<br/>would be:&#160;<br/>¼&#160;&#160;Locked &#160;<br/>¼&#160;&#160;Access granted&#160;<br/>
We use this example to very basically explain the state concept of&#160;CANdela Studio.&#160;<br/>
&#160;&#160;<br/>
<b>Cross reference:</b>&#160;For more detailed information about this topic refer to the CANdesc&#160;<br/>Technical Reference.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>5.3&#160;</b><br/>
<b>Creating and editing State Groups, States and Transitions&#160;</b><br/>
&#160;<br/>
To create or&#160;edit the State Groups, click on [State Groups] in the&#160;CANdela Studio&#160;<br/>tree. Enter the new State&#160;Group Security Access by clicking&#160;on the text. A new State&#160;<br/>Group will be&#160;created called: &#160;<br/>
New State Group 1.&#160;<br/>
If you generate more than&#160;one State Group without renaming the previous&#160;ones, the&#160;<br/>groups are numbered&#160;counting from 1 up. &#160;<br/>
To edit the new State Group you have two options. The first is&#160;to click&#160;on the State&#160;<br/>Group name and edit the name, then click on&#160;the description field and enter&#160;the&#160;text.&#160;<br/>Another&#160;way is to open the&#160;pull down menu of&#160;the State Group with&#160;a right click on the&#160;<br/>row of&#160;<b>SecurityAccess</b>&#160;and select&#160;<b>Properties</b>. The&#160;<b>Properties&#160;of State Group&#160;<br/>Security&#160;Access”</b>&#160;window&#160;will open. Enter the name and description.&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 45 -&#160;<br/>
<hr/>
<a name=46></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-46_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-46_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-46_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-46_4.png"/><br/>
Further Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>Info:</b>&#160;The qualifier&#160;will be&#160;created automatically.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Now we&#160;can&#160;add the states&#160;below&#160;in the&#160;same&#160;way. Click on&#160;the text to create a new&#160;<br/>element, adjust the names&#160;and enter&#160;a description.&#160;<br/>
The next step&#160;is to assign the relevant services&#160;to the&#160;states.&#160;<br/>
&#160;&#160;<br/>
Defining&#160;States for&#160;<br/>the Service&#160;<br/>SecurityAccess –&#160;<br/>Request Seed&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Select the Diagnostic Instance Security Access Seed&#160;and open the&#160;<b>Properties</b>&#160;of the&#160;<br/><b>Service Request Seed</b>. Select the tab&#160;<b>State Transitions</b>&#160;and then&#160;<b>SecurityAccess</b>.&#160;<br/>
- 46 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=47></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-47_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-47_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-47_3.png"/><br/>
User Manual CANdesc &#160;<br/>
Further Information&#160;<br/>
You&#160;see the&#160;service&#160;with the two columns states&#160;<b>Locked</b>&#160;and&#160;<b>Access</b>&#160;<b>granted</b>.&#160;<br/>
&#160;&#160;<br/>&#160;<br/>
<b>Info:</b>&#160;To&#160;select yes or no&#160;just select the&#160;row, click on&#160;the yes/no and then use the pull&#160;<br/>down menu.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Pull down menu selections:&#160;<br/>
<b>No</b>&#160;= Must not be executed&#160;<br/>
&#160;<br/>
<b>Yes</b>&#160;= may be&#160;executed, no state transition&#160;<br/>
<b>Locked</b>&#160;= state transition&#160;<br/>
<b>Access granted</b>&#160;=&#160;state transition&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
The following&#160;figure shows the properties for the service&#160;<b>Send Key</b>&#160;in the Key&#160;<br/>instance.&#160;This&#160;service is&#160;also assigned to&#160;both of the states, but there is also a&#160;<br/><b>transition to&#160;state&#160;</b>defined. How do you&#160;interpret this&#160;entry? &#160;<br/>
The service&#160;<b>Send Key</b>&#160;could be executed&#160;in the state&#160;<b>Locked</b>. If the data is&#160;<br/>processed (depending on the OEM, this must&#160;be done&#160;by the application or is a&#160;<br/>generated, OEM-specific&#160;Code) and a positive response is sent back, CANde<br/>
&#160;<br/>
sc<br/>
switches&#160;the&#160;state from&#160;<b>Locked</b>&#160;to&#160;<b>Access Granted</b>. In case of a negative re<br/>
o<br/>
sp&#160;nse&#160;<br/>
the ECU remains in the&#160;diagno<br/>
&#160;state&#160;<br/>
stic<br/>
Locked.&#160;<br/>
&#160;&#160;<br/>
A positive response&#160;<br/>is the trigger for a&#160;<br/>transition from&#160;the&#160;<br/>Locked state&#160;to the&#160;<br/>state Access&#160;granted&#160;<br/>
&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>5.4&#160;</b><br/>
<b>Connection between the states and your application&#160;</b><br/>
&#160;<br/>
The initial state after the ECU&#160;starts&#160;is the st<br/>
this case the&#160;<br/>
ate at the top of the list. In&#160;<br/>
initial state is&#160;Locked.&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 47 -&#160;<br/>
<hr/>
<a name=48></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-48_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-48_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-48_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-48_4.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-48_5.png"/><br/>
Further Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>Info:</b>&#160;Think about the states&#160;very carefully before&#160;editing. Make&#160;sure that the initial&#160;<br/>state is listed on top.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;The state transition mentioned&#160;above is monitored to your application&#160;via a&#160;<br/>callback function. You will find the prototype of this function,&#160;as usual, in the&#160;<br/>
&#160;<br/>
appdesc.h file. It may look like this:&#160;<br/>
void ApplDescOnTransitionSecurityAccess(DescStateGroup&#160;<br/>newState, DescStateGroup formerState);&#160;<br/>
The parameters&#160;show&#160;the&#160;direction of the transition. Provide the function and react to&#160;<br/>a transition as&#160;you wish.&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;There is another way to switch states. Leave the transition to state empty&#160;<br/>and do the&#160;state transition in your application. This&#160;could look&#160;like:&#160;<br/>
&#160;<br/>
DescSetStateSecurityAccess(&#160;<br/>kDescStateSecurityAccessAccess_granted );&#160;<br/>
Use &#160;<br/>
DescStateGroup DescGetStateSession (void)&#160;<br/>
to find out the current session.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The function declaration and parameter can be&#160;found in the generated file&#160;<br/>desc.h.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>5.5&#160;</b><br/>
<b>Diagnostic Buffer&#160;</b><br/>
&#160;<br/>
As&#160;described in chapter&#160;How to handle User-Defined&#160;Handlers&#160;on page&#160;35, the&#160;<br/>diagnostic buffer is an area&#160;in the RAM where the application and&#160;the CANdesc&#160;<br/>Software&#160;Component are&#160;allowed to write on&#160;and read from. How this is handled&#160;is&#160;<br/>described in this chapter&#160;above.&#160;<br/>
What is not explained until&#160;now is:&#160;<br/>¼&#160;&#160;how to choose the length of&#160;the diagnostic buffer&#160;<br/>¼&#160;&#160;that there are&#160;two mechanisms of using&#160;the buffer and&#160;<br/>¼&#160;&#160;when to use&#160;which mechanism &#160;<br/>
&#160;&#160;<br/>
<b>5.5.1&#160;&#160;Linear Diagnostic Buffer&#160;</b><br/>
&#160;<br/>
The easiest way of using the diagnostic buffer is to use it as a linear buffer. The&#160;size&#160;<br/>of the buffer in bytes must be the size of&#160;the longest data (diagnostic response or&#160;<br/>request).&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Normally&#160;this is a diagnostic trouble code&#160;message (DTC) and can reach up&#160;to&#160;<br/>100 bytes and&#160;more.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Copy the complete response information to&#160;the diagnostic buffer&#160;and confirm this via&#160;<br/>the call of&#160;DescProcessingDone.&#160;<br/>
- 48 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=49></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-49_1.png"/><br/>
User Manual CANdesc &#160;<br/>
Further Information&#160;<br/>
This is&#160;easy to handle but there are&#160;some&#160;disadvantages arising with this concept:&#160;<br/>¼&#160;&#160;The RAM&#160;consumption could be enormous&#160;<br/>¼&#160;&#160;The delay time&#160;between the reception of&#160;a Diagnostic Request and&#160;the first&#160;<br/>
response message&#160;could be very long,&#160;depending on&#160;the service and the amount&#160;<br/>
f the respon<br/>
of bytes o<br/>
se message.&#160;<br/>
There is another concept&#160;without these&#160;disadvantages but this&#160;concept needs&#160;a little&#160;<br/>bit more insight in CANdesc&#160;func&#160;onality.&#160;<br/>
ti<br/>
&#160;&#160;<br/>
<b>5.5.2&#160;&#160;Ring Buffer&#160;Mechanism&#160;</b><br/>
&#160;<br/>
There are&#160;several reason<br/>
ring buffe<br/>
s for using the&#160;<br/>
r mechanism:&#160;<br/>
¼&#160;&#160;Little RAM consum<br/>
cau<br/>
ption be<br/>
se of small diagnostic buffer&#160;<br/>
¼&#160;&#160;Shorter delay&#160;between the diagnostic request and the&#160;first response message&#160;<br/>
The ring buffer mechanism offers&#160;the following features:&#160;<br/>¼&#160;&#160;Asynchronous writing of serial diagnostic data to the diagnostic buffer&#160;<br/>¼&#160;&#160;Underrun allowed, time monitored&#160;(in case of TP underrun&#160;the PostHandler is&#160;<br/>
called with a&#160;Tx error code)&#160;<br/>
¼&#160;&#160;Overrun prevented and monitored via return code&#160;<br/>
One of the advantages of the ring buffer&#160;mechanism is the little RAM consumption&#160;<br/>(compared&#160;with the linear buffer). The&#160;consequence is that this little&#160;diagnostic buffer&#160;<br/>can hold less&#160;data than a diagnostic buffer de<br/>
ed for linea<br/>
sign<br/>
r buffer mechanism.&#160;<br/>
That means that the application has to fill&#160;the buffer in portions until&#160;the complete&#160;<br/>diagnostic response is sent.&#160;<br/>
The following&#160;example is very simple&#160;and designed to understand the concept behind&#160;<br/>the ring buffer mechanism.&#160;<br/>
&#160;&#160;<br/>
Ring Buffer STEP 1&#160;<br/>– Application Data&#160;<br/>and Ring Buffer&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Starting point&#160;is a diagnostic buffer&#160;with&#160;10 bytes size&#160;and 12 bytes of application&#160;data&#160;<br/>to be sent. First you have to set the length of the complete diag<br/>
stic data&#160;<br/>
no<br/>
(resDataLen = 12) and&#160;start the ring&#160;buffer mechanism&#160;<br/>(DescRingBufferStart).&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 49 -&#160;<br/>
<hr/>
<a name=50></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-50_1.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-50_2.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-50_3.png"/><br/>
Further Information&#160;<br/>
User Manual CANdesc&#160;<br/>
Ring Buffer STEP 2&#160;<br/>– First four data&#160;<br/>bytes are&#160;copied to&#160;<br/>
e Ring Buffer&#160;<br/>
th<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Now hand over the pointer&#160;to the location&#160;<br/>
plicatio<br/>
of the first four ap<br/>
n data bytes&#160;<br/>
e<br/>
(point&#160;r&#160;and amount of data -&#160;DescRingBufferWrite) to the CANdesc&#160;Software&#160;<br/>Component. CANdesc Basic&#160;copies the&#160;four data bytes to&#160;the diagnostic buffer.&#160;<br/>
&#160;&#160;<br/>
ng Buffer S<br/>
Ri<br/>
TEP 3&#160;<br/>
– Eight Data Bytes&#160;in&#160;<br/>the Diagnostic&#160;<br/>Buffer, six Bytes&#160;are&#160;<br/>being&#160;sent via CAN&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Hand&#160;over the pointer to the location&#160;of the next four application data bytes and&#160;<br/>CANdesc copies the data to&#160;the diagnostic buffer right&#160;<b>after</b>&#160;the first&#160;four bytes.&#160;Now&#160;<br/>there&#160;is enou<br/>
ta in the<br/>
gh da<br/>
&#160;buffer and CANdesc&#160;sends&#160;the first six&#160;data bytes via the&#160;<br/>
CAN bus.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The first&#160;2 bytes of the message are transport information and&#160;therefore not&#160;<br/>
&#160;<br/>
free<br/>
for application data&#160;(TP bytes on position 0 and 1).&#160;<br/>
&#160;<br/>
&#160;<br/>
- 50 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=51></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-51_1.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-51_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-51_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-51_4.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-51_5.png"/><br/>
User Manual CANdesc &#160;<br/>
Further Information&#160;<br/>
Ring Buffer STEP 4&#160;<br/>– The Diagnostic&#160;<br/>Buffer is filled&#160;round&#160;<br/>robin&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
Now there are only four bytes left to be copied to the Diagno<br/>
o&#160;<br/>
stic Buffer. The first tw<br/>
bytes are&#160;stored in position<br/>
&#160;9 of the&#160;<br/>
&#160;8 and<br/>
buffer, the next two bytes in position 0&#160;and&#160;<br/>
1.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Now it should be&#160;obvious&#160;why this&#160;concept is called Ring&#160;Buffer; the buffer&#160;is&#160;<br/>filled round robin.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
In a next step the six data bytes will be&#160;copied&#160;and sent via CAN starting with the byte&#160;<br/>on position 6.&#160;&#160;<br/>
That is the basic mechanism, but how do&#160;you know&#160;when there is enough space in&#160;<br/>the buffer?&#160;What happens if the application writes&#160;data and the buffer is not free?&#160;<br/>How to handle this buffer in code details?&#160;<br/>
&#160;&#160;<br/>
<b>5.5.2.1&#160;</b><br/>
<b>Activation of the Ring&#160;Buffer&#160;</b><br/>
Activation of Ring&#160;<br/>
Although the&#160;ring buffer could be used for any&#160;service and you can meet this decision&#160;<br/>
Buffer in GENy&#160;<br/>
at run-time you must activate&#160;this functionality in general. &#160;<br/>
Do this on&#160;the CANdesc configuration view in&#160;GENy&#160;by clicking the&#160;<b>Ring Buffer&#160;<br/>Support</b>&#160;checkbox.&#160;<br/>
&#160;&#160;<br/>
Activation of Ring&#160;<br/>
In&#160;CANgen&#160;you have to select the&#160;<b>Ring buffer&#160;</b>checkbox at tab&#160;<b>CANdesc Options</b>.&#160;<br/>
Buffer in CANgen&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>&#160;<br/>
<b>5.5.2.2&#160;</b><br/>
<b>Main&#160;Control Functions for&#160;the Ring Buffer Mechanism&#160;</b><br/>
<b>Cross reference:</b>&#160;For a more detailed description of the API refer to the&#160;<br/>TechnicalReference_CANdesc.pdf.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
DescRingBufferStart&#160;&#160;The call of this&#160;function&#160;starts the ring&#160;buffer mechanism. You can use it for any&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 51 -&#160;<br/>
<hr/>
<a name=52></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-52_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-52_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-52_3.png"/><br/>
Further Information&#160;<br/>
User Manual CANdesc&#160;<br/>
service and it replaces&#160;the&#160;DescProcessingDone&#160;that you use for the linear buffer&#160;<br/>mechanism.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Call&#160;DescRingBufferStart&#160;on MainHandler&#160;level.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
DescRingBufferWrite&#160;&#160;Via this function you tell CANdesc the location&#160;and the amount of the application&#160;<br/>
diagnostic data and the software&#160;component copies&#160;this data to the diagnostic buffer.&#160;<br/>
The function has two parameters; one is&#160;a&#160;pointer&#160;which points to&#160;the memory&#160;<br/>location&#160;of the next diagnostic data. The&#160;other parameter is the amount of data that&#160;<br/>should be&#160;copied (should&#160;be lower or&#160;equal to the ring buffer size).&#160;<br/>
The return value of this function can be&#160;kDescOk&#160;or&#160;kDescFailed&#160;and indicates that&#160;<br/>the write process to the diagnostic buffer&#160;was&#160;successful or that there was not enough&#160;<br/>free space in the buffer.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;In case&#160;of&#160;kDescFailed&#160;no data has been&#160;written to the diagnostic buffer.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
sc<br/>
De<br/>
RingBufferGetF<br/>
This function&#160;shows the amount of free&#160;space in the&#160;diagnostic buffer.&#160;<br/>
reeSpace&#160;<br/>&#160;&#160;<br/>
DescRingBufferGetP<br/>
This function&#160;shows the amount of data&#160;that has already been&#160;written to the&#160;<br/>
rogress&#160;<br/>
diagnostic buffer (for this&#160;service).&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>5.5.2.3&#160;</b><br/>
<b>Examples for Ring Buffer Mechanism&#160;</b><br/>
&#160;<br/>
Now start the&#160;coding for the example above (chapter&#160;5.5.2). The diagnostic buffer is&#160;<br/>10 bytes and the amount of&#160;application data&#160;to be sent&#160;via a diagnostic response&#160;is&#160;<br/>12. In the example you write to the diagnostic buffer in&#160;four byte portions.&#160;<br/>
The examples&#160;use an OSEK-OS operating system,&#160;but it should&#160;be very easy&#160;for you&#160;<br/>to transfer this to a system&#160;without OSEK-OS.&#160;<br/>
&#160;&#160;<br/>
<b>ing Buffer Example 1 - “Write and Check”&#160;</b><br/>
<b>R</b><br/>
<b>Example:</b>&#160;MainHandler&#160;of the Service “Service”&#160;<br/>
<b>uint8 state;&#160;/*global&#160;variable*/</b><br/>
&#160;<br/>
<b>void ApplDescService(&#160;DescMsgContext*&#160;pMsgContext)</b><br/>
<b>{</b><br/>
<b>pMsgContext-&gt;resDataLen&#160;=&#160;12; &#160;/*amout&#160;of the&#160;complete&#160;data&#160;to be sent*/</b><br/>
<b>DescRingBufferStart(&#160;);&#160;</b><br/>
<b>state&#160;= 0;</b><br/>
<b>DescRingBufferWrite(&#160;&amp;dataPtr[state*4],&#160;4 );&#160;&#160;/*first write&#160;to diagnostic buffer*/</b><br/>
<b>state++;</b><br/>
<b>SetRelAlarm(ALServiceStateMachine,&#160;0, &lt;cycle&gt;&#160;);&#160;/*Alarm for&#160;activating the Basic&#160;</b><br/>
<b>TASK*/</b><br/>
<b>}</b><br/>
&#160;&#160;<br/>
&#160;<br/>
Define the length of the complete diagnostic&#160;response (resDataLen = 12) and start&#160;<br/>the ring buffer mechanism&#160;(DescRingBufferStart). The global variable&#160;state&#160;is to&#160;<br/>
- 52 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=53></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-53_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-53_2.png"/><br/>
User Manual CANdesc &#160;<br/>
Further Information&#160;<br/>
identify in which state your&#160;state machine&#160;is and it is an&#160;index for the data pointer&#160;<br/>dataPtr. &#160;<br/>
In the MainHandler&#160;you write to the diagnostic&#160;buffer the first time for this&#160;service - it&#160;<br/>must be free. So you can write the first four data bytes&#160;via&#160;DescRingBufferWrite.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;As the handling of the diagnostic (CANdesc only works if its task is&#160;called&#160;<br/>cyclically) needs a&#160;cyclic&#160;call of the DescTask() or DescStateTask() you have to fill&#160;<br/>
&#160;<br/>
the diagnostic buffer gradually e.g. by the means of a cyclic&#160;basic task. Otherwise the&#160;<br/>DescTask() or&#160;DescStateTask() would not be called and the CANdesc could not&#160;work.<br/>
&#160;&#160;<br/>
&#160;<br/>
Now start an&#160;alarm to get the basic task&#160;BTServiceStateMachine&#160;called all&#160;<br/>&lt;cycle&gt; ms.&#160;<br/>
&#160;&#160;<br/>
Basic Task to&#160;Handle&#160;<br/>
<b>TASK( BTServiceStateMachine )</b><br/>
the Service State&#160;<br/>
<b>{</b><br/>
Machine&#160;<br/>
<b>if(&#160;DescRingBufferWrite( &amp;dataPtr[state*4],&#160;4&#160;)&#160;==&#160;kDescOk&#160;)</b><br/>
<b>{</b><br/>
<b>state++;</b><br/>
<b>}&#160;</b><br/>
<b>if( state ==&#160;3 )&#160;</b><br/>
<b>{</b><br/>
<b>CancelAlarm( ALServiceStateMachine&#160;); &#160;&#160;/*all&#160;data (3x4 bytes)&#160;has been&#160;</b><br/>
<b>transferred&#160;to&#160;diagnostic&#160;buffer*/</b><br/>
<b>}</b><br/>
<b>TerminateTask( BTServiceStateMachine);</b><br/>
<b>}</b><br/>
&#160;&#160;<br/>
&#160;<br/>
This basic task is designed&#160;to write the next 8 data bytes to the diagnostic buffer.&#160;But&#160;<br/>the application does not know if the buffer is free&#160;or not (<b>Write and&#160;Check</b>). To&#160;get&#160;<br/>this information&#160;use the return value of the&#160;DescRingBufferWrite&#160;function. Is&#160;it&#160;<br/>kDescOk, then the write&#160;was successful and we&#160;can increment the state. If not&#160;<br/>(kDescFailed), we have&#160;to repeat writing the last&#160;four bytes agai<br/>
l of&#160;<br/>
n in the next cal<br/>
the task.&#160;&#160;<br/>
If&#160;state&#160;is equal to three,&#160;<br/>
een<br/>
i.e. all 12 bytes have b<br/>
&#160;written to the&#160;diagnostic buffer,&#160;<br/>
we cancel the&#160;alarm to stop<br/>
&#160;handlin<br/>
&#160;the<br/>
g of this diagnostic service.&#160;<br/>
&#160;&#160;<br/>
<b>am</b><br/>
<b>Ring Buffer Ex</b><br/>
<b>ple 2 - “Check and Write”&#160;</b><br/>
&#160;<br/>
The MainHandler for this&#160;example is the&#160;same as&#160;in example 1.&#160;<br/>
The difference is, that you first check whether there is&#160;enough free&#160;space in the buffer&#160;<br/>before you&#160;write the next data (<b>check and&#160;write</b>). Via the function&#160;<br/>DescRingBufferGetFreeSpace&#160;you get the information about the free space in&#160;<br/>the buffer. If there is&#160;enough space, write&#160;the next data and increm<br/>
t,&#160;<br/>
ent the state, if no<br/>
terminate the&#160;task and repeat the try&#160;with the next activation of the task.&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;&#160;<br/>
&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 53 -&#160;<br/>
<hr/>
<a name=54></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-54_1.png"/><br/>
Further Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>TASK( BTServiceStateMachine )</b><br/>
<b>{</b><br/>
<b>DescMsgLen&#160;freeSpace;</b><br/>
<b>freeSpace =&#160;DescRingBufferGetFreeSpace(); &#160;/*MISRA*/</b><br/>
<b>if(&#160;freeSpace&#160;&gt;= 4&#160;)</b><br/>
<b>{</b><br/>
<b>DescRingBufferWrite(&#160;&amp;dataPtr[state*4], 4&#160;);</b><br/>
<b>state++;</b><br/>
<b>}&#160;</b><br/>
<b>if( state ==&#160;3 )&#160;</b><br/>
<b>{</b><br/>
<b>CancelAlarm( ALServiceStateMachine&#160;); &#160;&#160;/*all&#160;data (3x4 bytes)&#160;has been&#160;</b><br/>
<b>transferred&#160;to&#160;diagnostic</b><br/>
<b>u</b><br/>
<b>&#160;b&#160;ffer*/</b><br/>
<b>}</b><br/>
<b>TerminateTask( BTServiceStateMachine);</b><br/>
<b>}</b><br/>
&#160;&#160;<br/>
<b>ing Buffer Example 3 – “GetProgress”&#160;</b><br/>
<b>R</b><br/>
&#160;<br/>
In this example&#160;you use th<br/>
a<br/>
e alre&#160;dy mentioned function&#160;<br/>
DescRingBufferGetProgress&#160;to figure out how many bytes you have written to&#160;<br/>the buffer until&#160;now. This makes the example much easier&#160;but a little bit more difficult&#160;<br/>to understand&#160;why it works&#160;in this way. &#160;<br/>
As you see you do not need&#160;a global variable for the state. The state now is&#160;defined&#160;<br/>by the amount of data that&#160;you have already written to&#160;the buffer.&#160;<br/>
&#160;<br/>
<b>Example:</b>&#160;&#160;<br/>
&#160;<br/>
<b>void&#160;ApplDescService(DescMsgContext*&#160;pMsgContext)</b><br/>
<b>{</b><br/>
<b>pMsgContext-&gt;resDataLen&#160;=&#160;12;</b><br/>
<b>DescRingBufferStart();</b><br/>
<b>DescRingBufferWrite(&#160;&amp;dataPtr[&#160;DescRingBufferGetProgress()&#160;], 4);&#160;/*&#160;will&#160;be&#160;0&#160;at&#160;</b><br/>
<b>the&#160;beginning*/</b><br/>
<b>SetRelAlarm(&#160;ALServiceStateMachine,&#160;0,&#160;cycle&#160;);&#160;/*Alarm&#160;for activating the&#160;Basic&#160;</b><br/>
<b>TASK*/</b><br/>
<b>}</b><br/>
<b>TASK( BTServiceStateMachine )</b><br/>
<b>{</b><br/>
<b>DescMsgLen&#160;progress&#160;=&#160;DescRingBufferGetProgress();</b><br/>
<b>if(progress &lt;&#160;12)</b><br/>
<b>{</b><br/>
<b>DescRingBufferWrite( &amp;data</b><br/>
<b>[&#160;</b><br/>
<b>Ptr</b><br/>
<b>progress ],&#160;4 );</b><br/>
<b>}</b><br/>
<b>TerminateTask( BTServiceStateMachine&#160;);</b><br/>
<b>}</b><br/>
&#160;&#160;<br/>
<b>Conclusion&#160;</b><br/>
&#160;<br/>
As you see in&#160;these three little examples,&#160;the handling&#160;of the ring buffer is always&#160;the&#160;<br/>same. You&#160;start the writing,&#160;you write cyclically and in&#160;portions and&#160;you have to define&#160;<br/>an ending criteria – a typical state machine. &#160;<br/>
CANdesc offers a feature&#160;to support that&#160;kind of handling that is not only useful when&#160;<br/>working with ring buffer mechanism – the repeated service call.&#160;<br/>
&#160;&#160;<br/>
- 54 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=55></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-55_1.png"/><br/>
User Manual CANdesc &#160;<br/>
Further Information&#160;<br/>
<b>5.6&#160;</b><br/>
<b>Repeated&#160;Service Call Feature&#160;</b><br/>
&#160;<br/>
The easy way would be to&#160;transfer all data in the MainHandler&#160;to the diagnostic&#160;<br/>buffer, to call&#160;DescProcessingDone&#160;and the service is done.&#160;<br/>
But what to do with information that cannot be provided immediate<br/>
aso<br/>
ly? For this re<br/>
n&#160;<br/>
you have to trigger a further function that&#160;handles&#160;the&#160;provision of diagnostic da<br/>
d&#160;<br/>
ta an<br/>
then finishes&#160;the service via&#160;DescProcessingDone.&#160;<br/>
The Repeated&#160;Service&#160;Call&#160;helps you to&#160;handle&#160;situations like above very easy. Via&#160;<br/>the function&#160;call&#160;DescStartRepeatedServiceCall( CyclicFunction )&#160;you&#160;<br/>trigger the call&#160;of the&#160;“CyclicFunction”&#160;with the call cycle of&#160;DescTask<br/>
ith&#160;<br/>
&#160;or w<br/>
the call of&#160;<br/>
cStateTask<br/>
Des<br/>
.&#160;<br/>
&#160;&#160;<br/>
Repeated Service&#160;<br/>
<b>CanDesc</b><br/>
<b>ApplDescMainHandler</b><br/>
<b>CyclicFunction</b><br/>
Call&#160;<br/>
call<br/>
<b>DescStartRepeatedServiceCall(CyclicFunction)</b><br/>
&#160;&#160;<br/>
&#160;<br/>
The&#160;<b>CyclicFunction</b>&#160;can&#160;be the function where from&#160;you call the repeated&#160;service call&#160;<br/>or a second function. &#160;<br/>
At the end of the service handling you&#160;can stop the function from&#160;being called&#160;<br/>cyclically in two ways:&#160;<br/>¼&#160;&#160;call DescProcessingDone&#160;in linear mode&#160;<br/>¼&#160;&#160;if you have copied all announced data bytes to the diagnostic buffer if ring buffer&#160;<br/>
mechanism is used&#160;<br/>
The repeated&#160;service call is&#160;stopped too,&#160;if&#160;you &#160;<br/>¼&#160;&#160;call DescRingBufferStart&#160;<br/>¼&#160;&#160;call (another)&#160;DescStartRepeatedServiceCall( )&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;Using repeated&#160;service call and the ring buffer you have to take care about&#160;the&#160;<br/>order&#160;DescRingBufferStart&#160;and&#160;DescStartRepeatedServiceCall.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>6.1&#160;</b><br/>
<b>5.</b><br/>
<b>Activation of the Repeated Service Call&#160;</b><br/>
&#160;<br/>
u<br/>
As the ring b&#160;ffer mechanism you have&#160;to activate the repeated service call in the&#160;<br/>generation tool.&#160;<br/>
In&#160;GENy&#160;you have to select a mode for repeated service call in the CANdesc&#160;<br/>configuration view.&#160;CANgen&#160;offers the&#160;same modes in&#160;the CANdesc option tab.&#160;<br/>
As you see in&#160;the screenshot there are&#160;three modes for the Repeated Service Call:&#160;<br/>
&#160;&#160;<br/>
&#160;&#160;<br/>
<b>Deactivated&#160;</b><br/>
You cannot use this feature at all.&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 55 -&#160;<br/>
<hr/>
<a name=56></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-56_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-56_2.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-56_3.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-56_4.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-56_5.png"/><br/>
Further Information&#160;<br/>
User Manual CANdesc&#160;<br/>
&#160;&#160;<br/>
<b>Deactivated&#160;</b><br/>
You cannot use this feature at all.&#160;<br/>
&#160;<br/>
The repeated&#160;service call is&#160;switched to on for any service in the&#160;<br/>
<b>Always&#160;</b><br/>
way that the MainHandler&#160;is called cyclically as long&#160;as you call&#160;<br/>DescProcessingDone&#160;or all data is written to the ring buffer.&#160;<br/>
&#160;<br/>
With the individual setting you decide for&#160;every service&#160;whether to&#160;<br/>use the&#160;repeated service call or not.&#160;To use it, just&#160;activate it via&#160;<br/>
<b>Individual&#160;</b><br/>
DescStartRepeatedServiceCall&#160;as you see in the following&#160;<br/>examples.&#160;<br/>
&#160;&#160;<br/>
Selection for&#160;<br/>Repeated Service&#160;<br/>Call in GENy&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Selection for&#160;<br/>Repeated Service&#160;<br/>Call in CANgen&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
The following&#160;two examples&#160;show the handling of the ring buffer mechanism using the&#160;<br/>repeated service call.&#160;<br/>
&#160;&#160;<br/>
<b>Info:</b>&#160;The setting in the generation tool is&#160;individual.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
<b>5.6.2&#160;&#160;Repeated Service Call and Ring&#160;Buffer 1 – “Write and Check”&#160;</b><br/>
&#160;<br/>
This is the same example&#160;as in the chapter dealing&#160;with the ring&#160;buffer mechanism.&#160;<br/>This time use the repeated service call instead of the OSEK-OS task. And in this&#160;first&#160;<br/>example, define the MainHandler&#160;itself to be called cyclically via:&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;DescStartRepeatedServiceCall( ApplDescService );&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
For this&#160;case&#160;the MainHandler must be realized as&#160;a state machine because the&#160;start&#160;<br/>of the repeated service&#160;call&#160;has to be done only once&#160;per diagnostic&#160;request handling.&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;&#160;<br/>
&#160;<br/>
- 56 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=57></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-57_1.png"/><br/>
User Manual CANdesc &#160;<br/>
Further Information&#160;<br/>
<b>uint8 state; /*global variable, set&#160;to 0 in PreHandler*/</b><br/>
<b>void&#160;ApplDescService( DescMsgContext*&#160;pMsgContext)</b><br/>
<b>{</b><br/>
<b>if( state&#160;== 0)</b><br/>
<b>{</b><br/>
<b>pMsgContext-&gt;resDataLen&#160;=&#160;12;</b><br/>
<b>/*amout&#160;of&#160;the complete&#160;data&#160;to&#160;be&#160;sent*/</b><br/>
<b>DescRingBufferStart( );</b><br/>
<b>DescRingBufferWrite( &amp;dataPtr[&#160;state*4&#160;], 4 )</b><br/>
<b>DescStartRepeatedServiceCall(ApplDescService);</b><br/>
<b>state++;</b><br/>
<b>}</b><br/>
<b>else</b><br/>
<b>{</b><br/>
<b>if(&#160;DescRingBufferWrite(&#160;*dataPtr[&#160;state*4&#160;], 4&#160;)&#160;== kDescOk&#160;)</b><br/>
<b>{</b><br/>
<b>state++;&#160;/*if&#160;resDataLen data&#160;bytes&#160;have&#160;been&#160;copied&#160;to&#160;the&#160;diagnostic&#160;&#160;&#160;</b><br/>
<b>buffer the&#160;repeated&#160;service&#160;call stops&#160;automatically*/</b><br/>
<b>}</b><br/>
<b>}</b><br/>
<b>}</b><br/>
&#160;&#160;<br/>
<b>5.6.3&#160;&#160;Repeated Service Call and Ring&#160;Buffer 2 – “Check and Write”&#160;</b><br/>
&#160;<br/>
Now add a&#160;second function&#160;and call it cyclically after the MainHandler has been&#160;<br/>called. The MainHandler&#160;acts as&#160;initialization of the state machine&#160;and the second&#160;<br/>function handles all further&#160;states.&#160;<br/>
&#160;&#160;<br/>
<b>Example:</b>&#160;&#160;<br/>
&#160;<br/>
<b>uint8&#160;state;&#160;/*global variable*/</b><br/>
<b>void&#160;ApplDescService(&#160;DescMsgContext* pMsgContext)</b><br/>
<b>{</b><br/>
<b>state&#160;=&#160;0;</b><br/>
<b>pMsgContext-&gt;resDataLen&#160;=&#160;12;</b><br/>
<b>/*amout&#160;of the&#160;complete&#160;data&#160;to&#160;be&#160;</b><br/>
<b>sent*/</b><br/>
<b>DescRingBufferSt</b><br/>
<b>( );</b><br/>
<b>art</b><br/>
<b>DescRingBufferWrite(&#160;&amp;dataPtr[&#160;state*4</b><br/>
<b>&#160;4</b><br/>
<b>&#160;],</b><br/>
<b>)</b><br/>
<b>DescStartRepeatedServiceCall(&#160;SecondFunction&#160;);</b><br/>
<b>}</b><br/>
<b>void&#160;SecondFunction(&#160;DescMsgContext*&#160;pMsgContext&#160;)&#160;/*prototype must be defined&#160;</b><br/>
<b>by&#160;application*/</b><br/>
<b>{</b><br/>
<b>DescMsgLen&#160;freeSpace;</b><br/>
<b>freeSpace =&#160;DescRingBufferGetFreeSpace(); &#160;/*MISRA*/</b><br/>
<b>if(&#160;freeSpace&#160;&gt;= 4&#160;)</b><br/>
<b>{</b><br/>
<b>state++;&#160;</b><br/>
<b>DescRingBufferWrite(&#160;&amp;dataPtr[</b><br/>
<b>tat</b><br/>
<b>&#160;s</b><br/>
<b>e*4&#160;],&#160;4&#160;);&#160;</b><br/>
<b>/*if&#160;resDataLen&#160;(12)&#160;data byte</b><br/>
<b>hav</b><br/>
<b>s&#160;</b><br/>
<b>e been&#160;copied&#160;to&#160;the diagnostic buffer</b><br/>
<b>the&#160;repeated service call</b><br/>
<b>op</b><br/>
<b>&#160;st</b><br/>
<b>s automatically*/</b><br/>
<b>}</b><br/>
<b>}</b><br/>
&#160;&#160;<br/>&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 57 -&#160;<br/>
<hr/>
<a name=58></a>Additional Information&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>6&#160;Additional&#160;</b><br/>
<b>o</b><br/>
<b>Informati&#160;n&#160;</b><br/>
<b>In this chapter&#160;you find the following&#160;information:&#160;</b><br/>
6.1&#160;<br/>
Persistors&#160;<br/>
&#160;page&#160;59<br/>
&#160;<br/>
Update Persistors – Install&#160;current&#160;Version&#160;<br/>
&#160;&#160;<br/>
- 58 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=59></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-59_1.png"/><br/>
User Manual CANdesc &#160;<br/>
Additional Information&#160;<br/>
<b>6.1&#160;</b><br/>
<b>Persistors&#160;</b><br/>
What is the Persistor&#160;&#160;The CANdela&#160;data base file&#160;(CDD) is&#160;created by&#160;CANdela Studio&#160;and used by&#160;GENy&#160;<br/>for?&#160;<br/>
for configuring CANdesc.&#160;<br/>
If you use a newer&#160;version&#160;of the&#160;CANdela Studio, the format of the CDD file could be&#160;<br/>also newer than your&#160;GENy&#160;is able to deal with.&#160;<br/>
The Persistors are&#160;responsible to convert the newer&#160;CDD file into a&#160;CDD file which is&#160;<br/>able to read&#160;by&#160;GENy. &#160;<br/>
&#160;&#160;<br/>
Update Persistors&#160;–&#160;<br/>
The latest Persistors can be&#160;downloaded&#160;from Vector&#160;homepage&#160;<br/>
Download current&#160;<br/>
<b>www.vector.com</b>.&#160;<br/>
Version&#160;<br/>
Select&#160;<b>Downloads</b>&#160;and then&#160;the three&#160;settings for&#160;<b>Products</b>,&#160;<b>Categories</b>&#160;and&#160;<br/><b>Standards</b>. &#160;<br/>¼&#160;&#160;Products: CANdela Studio&#160;<br/>¼&#160;&#160;Categories: Add-Ons/Freeware&#160;<br/>¼&#160;&#160;Standards: All Standards&#160;<br/>
&#160;&#160;<br/>
<b>Cross reference:</b>&#160;See the&#160;following illustration.&#160;<br/>
&#160;<br/>
&#160;&#160;<br/>
Available for&#160;<br/>
The name for the Persistors download is: &#160;<br/>
NT/2000/XP or&#160;<br/>
¼&#160;&#160;<b>Converters for CANdela&#160;diagnostic descriptions for Windows&#160;xxx</b>.&#160;<br/>
Windows 9.x&#160;<br/>&#160;&#160;<br/>&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 59 -&#160;<br/>
<hr/>
<a name=60></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-60_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-60_2.png"/><br/>
Additional Information&#160;<br/>
User Manual CANdesc&#160;<br/>
&#160;<br/>
&#160;<br/>
Download&#160;<br/>
Select on or&#160;more items from the list (<br/>
) and click on&#160;<b>[&gt;&gt;&#160;Select one or more items,&#160;</b><br/>
<b>then continue]</b>&#160;to download the files after entering&#160;some administrative information. &#160;<br/>
&#160;&#160;<br/>
<b>6.1.1&#160;&#160;Update Persistors – Install current Version&#160;</b><br/>
Follow description&#160;<br/>
Start the downloaded file&#160;<b>SetupPersistorsXP.exe</b>.&#160;<br/>
step by step&#160;<br/>&#160; &#160;&#160;<br/>
- 60 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=61></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-61_1.jpg"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-61_2.jpg"/><br/>
User Manual CANdesc &#160;<br/>
Additional Information&#160;<br/>
&#160;<br/>
&#160;<br/>
Click&#160;<b>[Next]</b>.&#160;<br/>
&#160;<br/>
&#160;<br/>
Select&#160;<b>Custom</b>&#160;and enter the path to the&#160;<b>…\Generators\Components</b>&#160;folder as&#160;<br/><b>Destination Folder for&#160;Custom Setup</b>&#160;and click&#160;<b>[OK]</b>.&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 61 -&#160;<br/>
<hr/>
<a name=62></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-62_1.png"/><br/>
<img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-62_2.jpg"/><br/>
Additional Information&#160;<br/>
User Manual CANdesc&#160;<br/>
&#160;<br/>
Click&#160;<b>[Install]</b>&#160;and the installation process will be&#160;started and then on&#160;<b>[Finish]</b>&#160;when&#160;<br/>ready.&#160;<br/>
&#160;&#160;<br/>
Ready&#160;<br/>
Now the current Persistors are installed&#160;and your&#160;GENy&#160;is able to read the latest CDD&#160;<br/>file.&#160;&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
- 62 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=63></a>User Manual CANdesc &#160;<br/>
FAQs&#160;<br/>
<b>7&#160;FAQs&#160;</b><br/>
<b>In this chapter&#160;you find the following&#160;information:&#160;</b><br/>
7.1&#160;<br/>
Introduction&#160;<br/>
&#160;page&#160;64<br/>
7.2&#160;<br/>
Frequently Asked Questions&#160;&#160;<br/>
page&#160;<br/>
64<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 63 -&#160;<br/>
<hr/>
<a name=64></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-64_1.png"/><br/>
FAQs&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>7.1&#160;</b><br/>
<b>Introduction&#160;</b><br/>
Find not search&#160;<br/>
You have a certain question? You just want&#160;to know&#160;how to do e.g. a certain setting&#160;<br/>without reading the whole&#160;document again?&#160;<br/>
Then go on&#160;reading&#160;the following&#160;list and use the links to get at the place in the&#160;<br/>document where your question will be answered.&#160;<br/>
This&#160;chapter&#160;will be extended continuously.&#160;<br/>
&#160;&#160;<br/>
<b>7.2&#160;</b><br/>
<b>Frequently&#160;Asked Questions&#160;</b><br/>
<b>FAQ:</b>&#160;RingBuffer and the UDS SuppressPositiveResponseMessageIndicationBit&#160;<br/>(SPRMIB)&#160;<br/>
&#160;<br/>
If the application wants to use the&#160;ring-buffer for a diagnostic service with a sub-<br/>function (usually service 0x19 &#34;ReadDtcInformation&#34;) it shall consider the SPRMIB&#160;<br/>prior deciding&#160;to start the ring buffer. The reason for that is, once the ring-buffer&#160;<br/>response is&#160;activated this&#160;means to CANdesc that the application&#160;wants to send data.&#160;<br/>But if the SPRMIB=TRUE, there shall be&#160;no positive response on&#160;the communication&#160;<br/>bus. So in such cases the&#160;Application shall follow the&#160;sequence below:&#160;<br/>
&#160;<br/>
if(pMsgContext-&gt;msgAddInfo.suppPosRes != 0)&#160;<br/>
{&#160;<br/>
&#160; DescProcessingDone();/* just close the service processing&#160;<br/>now. No response will be sent back*/&#160;<br/>
}&#160;<br/>
else&#160;<br/>
{&#160;<br/>
&#160; DescRingBufferStart(); /* initate the ring-buffer response&#160;<br/>transmission */&#160;<br/>
}&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
- 64 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=65></a>User Manual CANdesc &#160;<br/>
What’s new,&#160;what’s changed&#160;<br/>
<b>8&#160;&#160;What’s&#160;new, what’s&#160;changed&#160;</b><br/>
<b>In this chapter&#160;you find the following&#160;information:&#160;</b><br/>
<a href="UserManual_CANdescs.html#64">8.1&#160;</a><br/>
<a href="UserManual_CANdescs.html#64">Version 1.7&#160;</a><br/>
<a href="UserManual_CANdescs.html#64">&#160;page&#160;66</a><br/>
&#160;<br/>
<a href="UserManual_CANdescs.html#64">What’s&#160;new&#160;</a><br/>
&#160;<br/>
What’s&#160;changed&#160;<br/>
&#160;&#160;<br/>
&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 65 -&#160;<br/>
<hr/>
<a name=66></a>What’s new,&#160;what’s changed&#160;<br/>
User Manual CANdesc&#160;<br/>
<b>8.1&#160;</b><br/>
<b>Version 1.7&#160;</b><br/>
What’s&#160;new and&#160;<br/>
This explains&#160;the changes&#160;within this document form the previous Versi<br/>
&#160;<br/>
on to the one<br/>
what’s&#160;changed &#160;<br/>
mentioned in this headline.&#160;<br/>
&#160;<br/>
<b>8.1.1&#160;&#160;What’s new&#160;</b><br/>
w ch<br/>
Ne<br/>
apter&#160;<br/>
There is a new chapter for additional information about Persistors&#160;setup and update&#160;<br/>at chapter&#160;additional information (see&#160;section&#160;Persistors&#160;on page&#160;59).&#160;<br/>
Persistors setup&#160;and&#160;<br/>update &#160;<br/>&#160;&#160;<br/>
<b>8.1.2&#160;&#160;What’s changed&#160;</b><br/>
New Layout&#160;<br/>
The Document has got a new template.&#160;<br/>
&#160;<br/>
- 66 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=67></a>User Manual CANdesc &#160;<br/>
Address table&#160;<br/>
<b>9&#160;Address&#160;</b><br/>
<b>table&#160;</b><br/>
Vector Informatik&#160;<br/>
Vector Informatik&#160;GmbH &#160;<br/>
GmbH&#160;<br/>
Ingersheimer&#160;Str. 24 &#160;<br/>
D-70499 Stuttgart &#160;<br/>
one: +4<br/>
Ph<br/>
9 (711) 80670-0&#160;&#160;<br/>
Fax: +49 (711) 80670-111&#160;&#160;<br/>
mailto:info@de.vector.com&#160;&#160;<br/>
http://www.vector-informatik.com/&#160;<br/>
&#160;&#160;<br/>
Vector CANtech,&#160;Inc.&#160;&#160;Vector&#160;CANtech, Inc. &#160;<br/>
Suite 550 &#160;<br/>
39500 Orchard Hill Place &#160;<br/>
USA-Novi, Mi 48375 &#160;<br/>
Phone: +1&#160;(248) 449 9290&#160;&#160;<br/>
Fax: +1 (248) 449 9704 &#160;<br/>
mailto:info@us.vector.com&#160;&#160;<br/>
http://www.vector-cantech.com/&#160;<br/>
&#160;&#160;<br/>
Vector France SAS&#160;<br/>
Vector France SAS &#160;<br/>
168, Boulevard Camélinat &#160;<br/>
F-92240 Malakoff &#160;<br/>
Phone: +33 (1) 4231 4000&#160;&#160;<br/>
Fax: +33 (1)&#160;4231 4009 &#160;<br/>
mailto:info@fr.vector.com&#160;&#160;<br/>
http://www.vector-france.com/&#160;<br/>
&#160;&#160;<br/>
Vector GB Ltd.&#160;<br/>
Vector GB Ltd.&#160;<br/>
Rhodium Central Boulevard Blythe Valley Park&#160;<br/>
Solihull, Birmingham&#160;<br/>
West Midlands B90 8AS&#160;<br/>
Phone: +44 121 50681-50&#160;<br/>
mailto:info@uk.vector.com&#160;&#160;<br/>
http://www.vector-gb.co.uk&#160;<br/>
&#160;&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 67 -&#160;<br/>
<hr/>
<a name=68></a>Address table&#160;<br/>
User Manual CANdesc&#160;<br/>
Vector Japan&#160;Co.,&#160;<br/>
Vector&#160;Japan&#160;Co., Ltd. &#160;<br/>
Ltd. &#160;<br/>
Seafort&#160;Square Center Bld.&#160;18F &#160;<br/>
2-3-12, Higashi-shinagawa,&#160;Shinagawa-ku &#160;<br/>
J-140-0002 Tokyo &#160;<br/>
Phone: +81 3&#160;(5769) 7800&#160;&#160;<br/>
Fax: +81 3 (5769) 6975 &#160;<br/>
mailto:info@jp.vector.com&#160;&#160;<br/>
http://www.vector-japan.co.jp/&#160;<br/>
&#160;&#160;<br/>
Vector Korea&#160;IT Inc.&#160;<br/>
Vector Korea&#160;IT Inc.&#160;<br/>
Daerung Post&#160;Tower III, 508&#160;<br/>
Guro-d<br/>
uro<br/>
ong, G<br/>
-gu, 182-4&#160;<br/>
2<br/>
Seoul, 15&#160;-790&#160;<br/>
Republic&#160;of Korea&#160;<br/>
Phone: +82(0)2 2028 0600&#160;<br/>
Fax: +82(0)2&#160;2028 0604&#160;<br/>
mailto:info@kr.vector.com&#160;&#160;<br/>
http://www.vector-korea.com/&#160;<br/>
&#160;&#160;<br/>
VecScan AB &#160;<br/>
VecScan AB &#160;<br/>
Theres Svenssons Gata 9&#160;<br/>
SE-417 55 Göteborg &#160;<br/>
Phone: +46 (31) 76476-00&#160;&#160;<br/>
Fax: +46 (31) 76476-19 &#160;<br/>
mailto:info@se.vector.com&#160;&#160;<br/>
http://www.vecscan.com/&#160;<br/>
&#160;&#160;<br/>&#160;<br/>&#160;&#160;<br/>
- 68 -&#160;<br/>
Version 1.7&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
<hr/>
<a name=69></a>User Manual CANdesc &#160;<br/>
Glossar&#160;<br/>
<b>10 Glossar&#160;</b><br/>
<b>Callback function&#160;</b><br/>
This is&#160;a function provided&#160;by an application. E.g. the&#160;CAN Driver&#160;calls a callback&#160;<br/>function to allow the&#160;application to control some action, to make decisions at runtime&#160;<br/>and to influen<br/>
&#160;work o<br/>
ce the<br/>
f&#160;the driver.&#160;<br/>
<b>Diagnostics layer&#160;</b><br/>
Diagnostics services&#160;that ar<br/>
omotive appli<br/>
e used in aut<br/>
cations&#160;have&#160;recently become&#160;<br/>
standardized. As a result, basic&#160;requirements can be implemented&#160;by a software&#160;<br/>component for KWP20<br/>
S.&#160;<br/>
00/UD<br/>
&#160;&#160;<br/>&#160;<br/>
&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 69 -&#160;<br/>
<hr/>
<a name=70></a>User Manual CANdesc &#160;<br/>
Index&#160;<br/>
<b>11 Index&#160;</b><br/>
&#160;<br/>
DescRingBufferWrite&#160;.........................................&#160;52&#160;<br/>
<b>A</b>&#160;<br/>
development environment&#160;.................................&#160;32&#160;<br/>
Adapt Your Application&#160;Files&#160;..............................33&#160;<br/>
Diagnostic&#160;Buffer................................................&#160;48&#160;<br/>
AppDesc&#160;.............................................................36&#160;<br/>
Diagnostic&#160;Class&#160;..........................................&#160;18, 19&#160;<br/>
appdesc.h&#160;.....................................................31, 33&#160;<br/>
Diagnostic&#160;Instance......................................&#160;18, 19&#160;<br/>
application...........................................................33&#160;<br/>
Diagnostic Request....................&#160;11, 14, 17, 21, 35&#160;<br/>
Asynchronous&#160;writing..........................................49&#160;<br/>
Diagnostics&#160;..................................................&#160;11, 17&#160;<br/>
<b>C</b>&#160;<br/>
<b>E</b>&#160;<br/>
call-back&#160;function&#160;................................................48&#160;<br/>
Example&#160;1&#160;..........................................................&#160;52&#160;<br/>
CANbedded&#160;..................................................<br/>
2&#160;<br/>
24, 3<br/>
Example&#160;2&#160;..........................................................&#160;53&#160;<br/>
CANdela Studio&#160;...................&#160;11, 14, 19, 20, 45, 55&#160;<br/>
Example&#160;3&#160;..........................................................&#160;54&#160;<br/>
CANdesc..........................................&#160;11,&#160;14, 15, 33&#160;<br/>
Examples&#160;...........................................................&#160;52&#160;<br/>
Ndesc<br/>
CA<br/>
&#160;tab.......................................................15&#160;<br/>
Extended Session&#160;..............................................&#160;45&#160;<br/>
CANgen<br/>
.............<br/>
.........<br/>
........................................26&#160;<br/>
CanInitPowerOn&#160;.................................................33&#160;<br/>
<b>G</b>&#160;<br/>
CANoe&#160;..........................................................41, 42&#160;<br/>
Generate&#160;Files&#160;...................................................&#160;29&#160;<br/>
CDD&#160;..............................................................<br/>
4&#160;<br/>
11, 1<br/>
Generated&#160;..............................................&#160;11, 17, 23&#160;<br/>
Compile.........................................................24, 41&#160;<br/>
Generation Process&#160;.....................................&#160;11, 15&#160;<br/>
compiler&#160;..............................................................<br/>
&#160;<br/>
32<br/>
Generation Tool&#160;...........................................&#160;14,&#160;26&#160;<br/>
onfiguration<br/>
C<br/>
...................................&#160;24, 26, 35, 40&#160;<br/>
GENy&#160;.................................................................&#160;26&#160;<br/>
c&#160;c<br/>
y&#160;lic&#160;calls&#160;...........................................................33&#160;<br/>
<b>I</b>&#160;<br/>
<b>D</b>&#160;<br/>
Include&#160;.........................................................&#160;24, 33&#160;<br/>
data&#160;.....................................................................19&#160;<br/>
Initialization&#160;..................................................&#160;24, 33&#160;<br/>
DBC&#160;....................................................................14&#160;<br/>
initParameter......................................................&#160;33&#160;<br/>
DBC file...............................................................14&#160;<br/>
<b>K</b>&#160;<br/>
Default session&#160;...................................................45&#160;<br/>
KWP2000...........................................................&#160;16&#160;<br/>
delay&#160;...................................................................38&#160;<br/>
desc.c&#160;.................................................................30&#160;<br/>
<b>L</b>&#160;<br/>
desc.h&#160;...........................................................30, 33&#160;<br/>
Linear Diagnostic&#160;Buffer&#160;....................................&#160;48&#160;<br/>
desccore.h&#160;..........................................................30&#160;<br/>
Link&#160;..............................................................&#160;24, 41&#160;<br/>
DescInitPowerOn................................................33&#160;<br/>
<b>M</b>&#160;<br/>
DescRingBufferGetProgress&#160;..............................52&#160;<br/>
MainHandler...........................................&#160;24,&#160;32, 38&#160;<br/>
DescRingBufferStart&#160;...........................................51&#160;<br/>
makefile..............................................................&#160;32&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 70 -&#160;<br/>
<hr/>
<a name=71></a>User Manual CANdesc &#160;<br/>
Index&#160;<br/>
<b>N</b>&#160;<br/>
Service&#160;...............................................................&#160;18&#160;<br/>
Nomenclature&#160;..................................&#160;11, 17, 18, 19&#160;<br/>
service primitives&#160;...............................................&#160;19&#160;<br/>
None&#160;.......................................................11, 17, 23&#160;<br/>
Sessions&#160;............................................................&#160;45&#160;<br/>
signal..................................................................&#160;38&#160;<br/>
<b>O</b>&#160;<br/>
State Groups................................................<br/>
&#160;<br/>
44, 45<br/>
OEM........................................................11,&#160;17, 23&#160;<br/>
e Handlin<br/>
Stat<br/>
g&#160;.............................................&#160;44, 45&#160;<br/>
OSEK Transport&#160;<br/>
to<br/>
Pro&#160;col&#160;...................................26&#160;<br/>
States&#160;...........................................................<br/>
&#160;<br/>
44, 45<br/>
<b>P</b>&#160;<br/>
<b>T</b>&#160;<br/>
Programming session&#160;.........................................45&#160;<br/>
Test&#160;........................................................&#160;24,&#160;41, 42&#160;<br/>
roperies<br/>
P<br/>
............................................................38&#160;<br/>
test&#160;environment&#160;................................................&#160;41&#160;<br/>
protocol service...................................................18&#160;<br/>
transition to&#160;state................................................&#160;47&#160;<br/>
<b>R</b>&#160;<br/>
Transitions&#160;.........................................................&#160;45&#160;<br/>
RAM consumption&#160;........................................48, 49&#160;<br/>
<b>U</b>&#160;<br/>
Repeated Service&#160;Call Feature&#160;..........................55&#160;<br/>
UDS&#160;...................................................................&#160;16&#160;<br/>
Request&#160;..............................................................18&#160;<br/>
User&#160;.......................................................&#160;11,&#160;17, 23&#160;<br/>
Response............................................................18&#160;<br/>
User-Defined&#160;Handlers&#160;......................................&#160;35&#160;<br/>
Response&#160;Pending&#160;.............................................38&#160;<br/>
Ring Buffer Mechanism&#160;......................................49&#160;<br/>
<b>V</b>&#160;<br/>
value field...........................................................&#160;39&#160;<br/>
<b>S</b>&#160;<br/>
variable&#160;..............................................................&#160;38&#160;<br/>
security access&#160;...................................................45&#160;<br/>
&#160;<br/>
©&#160;Vector Informatik GmbH&#160;<br/>
Version 1.7&#160;<br/>
- 71 -&#160;<br/>
<hr/>
<a name=72></a><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/content/en/docs/GM_000A_GMLAN3.1MchRH850_Impl/doc/UserManual_CANdesc-72_1.jpg"/><br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>Get more Information!&#160;</b><br/>
<b>Visit our Website for:&#160;</b><br/>
&gt; News&#160;<br/>&gt; Products&#160;<br/>&gt; Demo Software&#160;<br/>&gt; Support&#160;<br/>&gt; Training Classes&#160;<br/>&gt; Addresses&#160;<br/>
&#160;<br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;</b><br/>
<b>&#160;<br/>&#160;<br/>www.vector-worldwid&#160;.com&#160;</b><br/>
<b>e</b><br/>
&#160;<br/>
<hr/>
<a name="outline"></a><h1>Document Outline</h1>
<ul>
<li><a href="UserManual_CANdescs.html#5">1 Manual Information</a>
<ul>
<li><a href="UserManual_CANdescs.html#7">1.1 About this user manual</a>
<ul>
<li><a href="UserManual_CANdescs.html#8">1.1.1 Certification</a></li>
<li><a href="UserManual_CANdescs.html#8">1.1.2 Warranty</a></li>
<li><a href="UserManual_CANdescs.html#8">1.1.3 Registered trademarks</a></li>
<li><a href="UserManual_CANdescs.html#8">Errata Sheet of manufacturers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#9">2 Getting Started</a>
<ul>
<li><a href="UserManual_CANdescs.html#10">2.1 How to use this Manual</a></li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#11">3 Basic Information</a>
<ul>
<li><a href="UserManual_CANdescs.html#12">An Overall View</a></li>
<li><a href="UserManual_CANdescs.html#13">3.2 What is Diagnostic</a></li>
<li><a href="UserManual_CANdescs.html#13">3.3 What happens during Diagnostics?</a></li>
<li><a href="UserManual_CANdescs.html#14">3.4 What is CANdesc?</a></li>
<li><a href="UserManual_CANdescs.html#14">3.5 Tools and Files</a>
<ul>
<li><a href="UserManual_CANdescs.html#14">3.5.1 CANdela Studio, CDDT, CDD</a></li>
<li><a href="UserManual_CANdescs.html#14">3.5.2 Generation Tool, CDD, DBC</a></li>
<li><a href="UserManual_CANdescs.html#15">3.5.3 Generation Process with CANbedded Software Components</a></li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#15">3.6 What CANdesc does</a></li>
<li><a href="UserManual_CANdescs.html#17">3.7 Diagnostics – a more detailed View</a>
<ul>
<li><a href="UserManual_CANdescs.html#18">3.7.1 Basic Nomenclature from the Bottom Up</a></li>
<li><a href="UserManual_CANdescs.html#19">3.7.2 The same Nomenclature from the Top Down</a></li>
<li><a href="UserManual_CANdescs.html#19">3.7.3 Where to find this Nomenclature in CANdela Studio</a></li>
<li><a href="UserManual_CANdescs.html#21">3.7.4 Generic Handling of a Diagnostic Request in the CANdesc Component</a></li>
<li><a href="UserManual_CANdescs.html#23">3.7.5 User, None, OEM, Generated – what does this mean?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#24">4 A Few STEPS to CANdesc</a>
<ul>
<li><a href="UserManual_CANdescs.html#25">4.1 STEP What do you need before start?</a></li>
<li><a href="UserManual_CANdescs.html#25">Startup Code</a></li>
<li><a href="UserManual_CANdescs.html#25">Overview</a></li>
<li><a href="UserManual_CANdescs.html#26">4.4 STEP Installation</a></li>
<li><a href="UserManual_CANdescs.html#26">4.5 STEP Configuration with the Generation Tool</a>
<ul>
<li><a href="UserManual_CANdescs.html#26">4.5.1 Using the Generation Tool CANgen</a></li>
<li><a href="UserManual_CANdescs.html#27">4.5.2 Using the Generation Tool GENy</a></li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#29">4.6 STEP Generating Files</a>
<ul>
<li><a href="UserManual_CANdescs.html#29">4.6.1 Using Generation Tool CANgen</a></li>
<li><a href="UserManual_CANdescs.html#32">4.6.2 Using the Generation Tool GENy</a></li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#32">4.7 STEP Add CANbedded to your Project</a></li>
<li><a href="UserManual_CANdescs.html#33">4.8 STEP Adapt Your Application Files</a>
<ul>
<li><a href="UserManual_CANdescs.html#33">4.8.1 Including, Initializing and Cyclic Calling</a></li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#35">4.9 STEP Functional Connection between your Application and CANdesc/CANdela Studio</a>
<ul>
<li><a href="UserManual_CANdescs.html#35">4.9.1 How to handle User-Defined Handlers</a></li>
<li><a href="UserManual_CANdescs.html#38">4.9.2 How to Handle Predefined Handlers (for MainHandler only)</a></li>
<li><a href="UserManual_CANdescs.html#40">4.9.3 Handling OEM-Specific Settings</a></li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#41">4.10 STEP Compile and link your Project</a></li>
<li><a href="UserManual_CANdescs.html#41">4.11 STEP Test it via CANoe</a>
<ul>
<li><a href="UserManual_CANdescs.html#41">4.11.1 Start CANoe.CAN OSEK TP enlarged</a></li>
<li><a href="UserManual_CANdescs.html#42">4.11.2 Test of CANdesc</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#44">5 Further Information</a>
<ul>
<li><a href="UserManual_CANdescs.html#45">5.1 Diagnostic State Handling using CANdela Studio</a></li>
<li><a href="UserManual_CANdescs.html#45">5.2 Typical Examples of State Groups and States in an Automotive Environment</a></li>
<li><a href="UserManual_CANdescs.html#45">5.3 Creating and editing State Groups, States and Transitions</a></li>
<li><a href="UserManual_CANdescs.html#47">5.4 Connection between the states and your application</a></li>
<li><a href="UserManual_CANdescs.html#48">5.5 Diagnostic Buffer</a>
<ul>
<li><a href="UserManual_CANdescs.html#48">5.5.1 Linear Diagnostic Buffer</a></li>
<li><a href="UserManual_CANdescs.html#49">5.5.2 Ring Buffer Mechanism</a>
<ul>
<li><a href="UserManual_CANdescs.html#51">5.5.2.1 Activation of the Ring Buffer</a></li>
<li><a href="UserManual_CANdescs.html#51">5.5.2.2 Main Control Functions for the Ring Buffer Mechanism</a></li>
<li><a href="UserManual_CANdescs.html#52">5.5.2.3 Examples for Ring Buffer Mechanism</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#55">5.6 Repeated Service Call Feature</a>
<ul>
<li><a href="UserManual_CANdescs.html#55">5.6.1 Activation of the Repeated Service Call</a></li>
<li><a href="UserManual_CANdescs.html#56">5.6.2 Repeated Service Call and Ring Buffer 1 – “Write and Check”</a></li>
<li><a href="UserManual_CANdescs.html#57">5.6.3 Repeated Service Call and Ring Buffer 2 – “Check and Write”</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#58">6 Additional Information</a>
<ul>
<li><a href="UserManual_CANdescs.html#59">Persistors</a>
<ul>
<li><a href="UserManual_CANdescs.html#60">6.1.1 Update Persistors – Install current Version</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#63">7 FAQs</a>
<ul>
<li><a href="UserManual_CANdescs.html#64">7.1 Introduction</a></li>
<li><a href="UserManual_CANdescs.html#64">7.2 Frequently Asked Questions</a></li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#65">8 What’s new, what’s changed</a>
<ul>
<li><a href="UserManual_CANdescs.html#66">8.1 Version 1.7</a>
<ul>
<li><a href="UserManual_CANdescs.html#66">8.1.1 What’s new</a></li>
<li><a href="UserManual_CANdescs.html#66">8.1.2 What’s changed</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="UserManual_CANdescs.html#67">Address table</a></li>
<li><a href="UserManual_CANdescs.html#69">10 Glossar</a></li>
<li><a href="UserManual_CANdescs.html#70">11 Index</a></li>
</ul>
<hr/>
</body>
</html>
