---
title: MotAg0Meas_MDD
linkTitle: MotAg0Meas_MDD
weight: 3
---

<p><strong>Motor Angle 0 Measurement</strong></p>
<p><strong>Module Design Document</strong></p>
<p><strong>VERSION: 1.0</strong></p>
<p><strong>DATE: 04-Nov-2016</strong></p>
<p><strong>Revision History</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 6%" />
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 12%" />
<col style="width: 17%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Sl. No.</strong></td>
<td><strong>Description</strong></td>
<td><strong>Author</strong></td>
<td><strong>Version</strong></td>
<td><strong>Date</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>Initial Version</td>
<td>Avinash James</td>
<td>1.0</td>
<td>04-Nov-2016</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Table of Contents</p>
<p><a href="#abbrevations-and-acronyms">1 Abbrevations And Acronyms 5</a></p>
<p><a href="#references">2 References 6</a></p>
<p><a href="#motag0meas-high-level-description">3 MotAg0Meas High-Level Description 7</a></p>
<p><a href="#design-details-of-software-module">3.1 Design details of software module 7</a></p>
<p><a href="#graphical-representation-of-cdd_motag0meas">3.2 Graphical representation of CDD_MotAg0Meas 7</a></p>
<p><a href="#data-flow-diagram">3.3 Data Flow Diagram 7</a></p>
<p><a href="#module-level-dfd">3.3.1 Module level DFD 7</a></p>
<p><a href="#sub-module-level-dfd">3.3.2 Sub-Module level DFD 7</a></p>
<p><a href="#component-flow-diagram">3.4 COMPONENT FLOW DIAGRAM 7</a></p>
<p><a href="#variable-data-dictionary">4 Variable Data Dictionary 8</a></p>
<p><a href="#user-defined-typedef-definitiondeclaration">4.1 User defined typedef definition/declaration 8</a></p>
<p><a href="#variable-definition-for-enumerated-types">4.2 Variable definition for enumerated types 8</a></p>
<p><a href="#constant-data-dictionary">5 Constant Data Dictionary 9</a></p>
<p><a href="#programfixed-constants">5.1 Program(fixed) Constants 9</a></p>
<p><a href="#embedded-constants">5.1.1 Embedded Constants 9</a></p>
<p><a href="#local">5.1.1.1 Local 9</a></p>
<p><a href="#global">5.1.1.2 Global 9</a></p>
<p><a href="#module-specific-lookup-tables-constants">5.1.2 Module specific Lookup Tables Constants 9</a></p>
<p><a href="#software-module-implementation">6 Software Module Implementation 10</a></p>
<p><a href="#sub-module-functions">6.1 Sub-Module Functions 10</a></p>
<p><a href="#motor-control-periodic-motag0measper1">6.1.1 Motor Control Periodic: MotAg0MeasPer1 10</a></p>
<p><a href="#design-rationale">6.1.1.1 Design Rationale 10</a></p>
<p><a href="#initialization-functions">6.2 Initialization Functions 10</a></p>
<p><a href="#init-motag0measinit1">6.2.1 Init: MotAg0MeasInit1 10</a></p>
<p><a href="#design-rationale-1">6.2.1.1 Design Rationale 10</a></p>
<p><a href="#module-outputs">6.2.1.2 Module Outputs 10</a></p>
<p><a href="#module-internal">6.2.1.3 Module Internal 10</a></p>
<p><a href="#periodic-functions">6.3 PERIODIC FUNCTIONS 10</a></p>
<p><a href="#per-motag0measper2">6.3.1 Per: MotAg0MeasPer2 10</a></p>
<p><a href="#design-rationale-2">6.3.1.1 Design Rationale 10</a></p>
<p><a href="#store-module-inputs-to-local-copies">6.3.1.2 Store Module Inputs to Local copies 10</a></p>
<p><a href="#processing-of-function">6.3.1.3 (Processing of function)……… 10</a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs">6.3.1.4 Store Local copy of outputs into Module Outputs 10</a></p>
<p><a href="#per-motag0measper3">6.3.2 Per: MotAg0MeasPer3 10</a></p>
<p><a href="#design-rationale-3">6.3.2.1 Design Rationale 10</a></p>
<p><a href="#store-module-inputs-to-local-copies-1">6.3.2.2 Store Module Inputs to Local copies 11</a></p>
<p><a href="#processing-of-function-1">6.3.2.3 (Processing of function)……… 11</a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs-1">6.3.2.4 Store Local copy of outputs into Module Outputs 11</a></p>
<p><a href="#interrupt-functions">6.4 Interrupt Functions 11</a></p>
<p><a href="#server-runnables">6.5 Server runnables 11</a></p>
<p><a href="#motag0coefftblread_oper">6.5.1.1 MotAg0CoeffTblRead_Oper 11</a></p>
<p><a href="#design-rationale-4">6.5.1.1.1 Design Rationale 11</a></p>
<p><a href="#store-module-inputs-to-local-copies-2">6.5.1.1.2 Store Module Inputs to Local copies 11</a></p>
<p><a href="#processing-of-function-2">6.5.1.1.3 (Processing of function)……… 11</a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs-2">6.5.1.1.4 Store Local copy of outputs into Module Outputs 11</a></p>
<p><a href="#motag0coefftblwr_oper">6.5.1.2 MotAg0CoeffTblWr_Oper 11</a></p>
<p><a href="#design-rationale-5">6.5.1.2.1 Design Rationale 11</a></p>
<p><a href="#store-module-inputs-to-local-copies-3">6.5.1.2.2 Store Module Inputs to Local copies 11</a></p>
<p><a href="#processing-of-function-3">6.5.1.2.3 (Processing of function)……… 11</a></p>
<p><a href="#store-local-copy-of-outputs-into-module-outputs-3">6.5.1.2.4 Store Local copy of outputs into Module Outputs 11</a></p>
<p><a href="#local-functionmacro-definitions">6.6 Local Function/Macro Definitions 12</a></p>
<p><a href="#local-function-1">6.6.1 Local Function #1 12</a></p>
<p><a href="#design-rationale-6">6.6.1.1 Design Rationale 12</a></p>
<p><a href="#local-function-2">6.6.2 Local Function #2 12</a></p>
<p><a href="#design-rationale-7">6.6.2.1 Design Rationale 12</a></p>
<p><a href="#global-functionmacro-definitions">6.7 GLObAL Function/Macro Definitions 12</a></p>
<p><a href="#transient-functions">6.8 TRANSIENT FUNCTIONS 12</a></p>
<p><a href="#known-limitations-with-design">7 Known Limitations With Design 13</a></p>
<p><a href="#unit-test-consideration">8 UNIT TEST CONSIDERATION 14</a></p>
<p><a href="#appendix">9 Appendix 15</a></p>
<h1 id="abbrevations-and-acronyms">Abbrevations And Acronyms</h1>
<table>
<colgroup>
<col style="width: 28%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Abbreviation</td>
<td>Description</td>
</tr>
<tr class="even">
<td>DFD</td>
<td>Design functional diagram</td>
</tr>
<tr class="odd">
<td>MDD</td>
<td>Module design Document</td>
</tr>
<tr class="even">
<td>FDD</td>
<td>Functional Design Document</td>
</tr>
</tbody>
</table>
<h1 id="references">References</h1>
<p>This section lists the title &amp; version of all the documents that are referred for development of this document</p>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 65%" />
<col style="width: 22%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Sr. No.</td>
<td>Title</td>
<td>Version</td>
</tr>
<tr class="even">
<td>&lt;1&gt;</td>
<td>MDD Guidelines</td>
<td>Software Process Release 04.20.00</td>
</tr>
<tr class="odd">
<td>&lt;2&gt;</td>
<td>Software Naming Conventions</td>
<td>Software Process Release 04.20.00</td>
</tr>
<tr class="even">
<td>&lt;3&gt;</td>
<td>Design and Coding standards</td>
<td>Software Process Release 04.20.00</td>
</tr>
<tr class="odd">
<td>&lt;4&gt;</td>
<td>FDD: CM620C_MotAg0Meas_Design</td>
<td>See Synergy subproject version</td>
</tr>
</tbody>
</table>
<h1 id="motag0meas-high-level-description">MotAg0Meas High-Level Description</h1>
<p>The CDD_MotAg0Meas component is the complex driver for the motor angle 0 measurement subsystem. This function initializes the registers for CSIH1 SPI channel for communicating with the motor angle 0 measurement sensor board. This function receives the RAW sensor data at 62.5uS rate. The component contains two source files, both described in this MDD: CDD_MotAg0Meas.c contains the RTE runnables and services; CDD_MotAg0Meas_MotCtrl.c contains the motor control runnable.</p>
<h2 id="design-details-of-software-module">Design details of software module</h2>
<p><em>See FDD.</em></p>
<h2 id="graphical-representation-of-cdd_motag0meas">Graphical representation of CDD_MotAg0Meas</h2>
<p><img src="ElectricPowerSteering_RH850_GM_G2KCA_website/static/media/image1.png" style="width:5.29236in;height:3.65833in" /></p>
<h2 id="data-flow-diagram">Data Flow Diagram</h2>
<p><em>See FDD.</em></p>
<h2 id="module-level-dfd">Module level DFD</h2>
<p><em>See FDD.</em></p>
<h2 id="sub-module-level-dfd">Sub-Module level DFD</h2>
<p><em>See FDD.</em></p>
<h2 id="component-flow-diagram">COMPONENT FLOW DIAGRAM</h2>
<p><em>See FDD.</em></p>
<h1 id="variable-data-dictionary">Variable Data Dictionary</h1>
<h2 id="user-defined-typedef-definitiondeclaration">User defined typedef definition/declaration </h2>
<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 31%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Typedef Name</td>
<td>Element Name</td>
<td>User Defined Type</td>
<td><p>Legal Range</p>
<p>(min)</p></td>
<td><p>Legal Range</p>
<p>(max)</p></td>
</tr>
<tr class="even">
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="variable-definition-for-enumerated-types">Variable definition for enumerated types</h2>
<table>
<colgroup>
<col style="width: 44%" />
<col style="width: 40%" />
<col style="width: 14%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Enum Name</td>
<td>Element Name</td>
<td>Value</td>
</tr>
<tr class="even">
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
</tbody>
</table>
<h1 id="constant-data-dictionary">Constant Data Dictionary</h1>
<h2 id="programfixed-constants">Program(fixed) Constants</h2>
<h2 id="embedded-constants">Embedded Constants</h2>
<h2 id="local">Local</h2>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 19%" />
<col style="width: 12%" />
<col style="width: 41%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Constant Name</td>
<td>Resolution</td>
<td>Units</td>
<td>Value</td>
</tr>
<tr class="even">
<td>MAX16BIT_CNT_U32</td>
<td>1</td>
<td>Cnt</td>
<td>65535U</td>
</tr>
<tr class="odd">
<td>PimMotAg0CoeffTbl</td>
<td></td>
<td></td>
<td>( *(Ary1D_f32_26 *) (Rte_Pim_MotAg0CoeffTbl()) )</td>
</tr>
<tr class="even">
<td>dPimMotAg0RawReg</td>
<td></td>
<td></td>
<td>( *(Ary1D_u32_10 *) (Rte_Pim_dMotAg0MeasMotAg0RawReg()) )</td>
</tr>
<tr class="odd">
<td><strong>Also see see FDD – CM620C_MotAg0Meas_DataDict.m file</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="global">Global</h2>
<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Constant Name</td>
</tr>
<tr class="even">
<td><blockquote>
<p>See FDD – CM620C_MotAg0Meas_DataDict.m file</p>
</blockquote></td>
</tr>
<tr class="odd">
<td></td>
</tr>
<tr class="even">
<td></td>
</tr>
</tbody>
</table>
<h2 id="module-specific-lookup-tables-constants">Module specific Lookup Tables Constants</h2>
<table>
<colgroup>
<col style="width: 42%" />
<col style="width: 20%" />
<col style="width: 18%" />
<col style="width: 18%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Constant Name</td>
<td>Resolution</td>
<td>Value</td>
<td>Software Segment</td>
</tr>
<tr class="even">
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
</tbody>
</table>
<h1 id="software-module-implementation">Software Module Implementation</h1>
<h2 id="sub-module-functions">Sub-Module Functions</h2>
<h2 id="motor-control-periodic-motag0measper1">Motor Control Periodic: MotAg0MeasPer1</h2>
<p>See FDD MotAg0MeasPer1 model block.</p>
<h2 id="design-rationale">Design Rationale</h2>
<blockquote>
<p>For run time efficiency in the motor control loop the <strong>Offset</strong> &amp; <strong>Compensate MechMtrPos</strong> block is implemented in a optimized way in the code by letting a uint16 variable be overflown.</p>
</blockquote>
<h2 id="initialization-functions">Initialization Functions</h2>
<h2 id="init-motag0measinit1">Init: MotAg0MeasInit1</h2>
<h2 id="design-rationale-1">Design Rationale</h2>
<p>All register initialization that is allowed at the register level (see Register/Field coloumn of the CM620C_MotAg0Meas_RegisterConfiguration.xlsm spreadsheet in the FDD) is done at the register level to save execution time as compared to the read/modify/writes that would be needed to initialize at the field level. Field level initialization done only where required by the spreadsheet.</p>
<h2 id="module-outputs">Module Outputs</h2>
<p>See FDD: MotAg0MeasInit1 model block.</p>
<h2 id="module-internal">Module Internal </h2>
<p>See FDD: MotAg0MeasInit1 model block for Per Instance Memory.</p>
<h2 id="periodic-functions">PERIODIC FUNCTIONS </h2>
<h2 id="per-motag0measper2"> Per: MotAg0MeasPer2</h2>
<h2 id="design-rationale-2">Design Rationale</h2>
<p>None</p>
<h2 id="store-module-inputs-to-local-copies">Store Module Inputs to Local copies</h2>
<p>See FDD: MotAg0MeasPer2 model block.</p>
<h2 id="processing-of-function">(Processing of function)………</h2>
<p>See FDD: MotAg0MeasPer2 model block.</p>
<h2 id="store-local-copy-of-outputs-into-module-outputs">Store Local copy of outputs into Module Outputs</h2>
<p>See FDD: MotAg0MeasPer2 model block</p>
<h2 id="per-motag0measper3">Per: MotAg0MeasPer3</h2>
<h2 id="design-rationale-3">Design Rationale</h2>
<p>None</p>
<h2 id="store-module-inputs-to-local-copies-1">Store Module Inputs to Local copies</h2>
<p>See FDD: MotAg0MeasPer3 model block.</p>
<h2 id="processing-of-function-1">(Processing of function)………</h2>
<p>See FDD: MotAg0MeasPer3 model block.</p>
<h2 id="store-local-copy-of-outputs-into-module-outputs-1">Store Local copy of outputs into Module Outputs</h2>
<p>See FDD: MotAg0MeasPer3 model block</p>
<h2 id="interrupt-functions">Interrupt Functions</h2>
<p>None</p>
<h2 id="server-runnables">Server runnables</h2>
<h2 id="motag0coefftblread_oper">MotAg0CoeffTblRead_Oper</h2>
<h2 id="design-rationale-4">Design Rationale</h2>
<p><em>None</em></p>
<h2 id="store-module-inputs-to-local-copies-2">Store Module Inputs to Local copies</h2>
<p><em>None</em></p>
<h2 id="processing-of-function-2">(Processing of function)………</h2>
<p><em>See</em> MotAg0CoeffTblRead <em>block in the FDD</em></p>
<h2 id="store-local-copy-of-outputs-into-module-outputs-2">Store Local copy of outputs into Module Outputs</h2>
<p><em>See</em> MotAg0CoeffTblRead <em>block in the FDD</em></p>
<h2 id="motag0coefftblwr_oper">MotAg0CoeffTblWr_Oper</h2>
<h2 id="design-rationale-5">Design Rationale</h2>
<p><em>None</em></p>
<h2 id="store-module-inputs-to-local-copies-3">Store Module Inputs to Local copies</h2>
<p><em>See</em> MotAg0CoeffTblWr <em>in the FDD</em></p>
<h2 id="processing-of-function-3">(Processing of function)………</h2>
<p><em>See</em> MotAg0CoeffTblWr <em>in the FDD</em></p>
<h2 id="store-local-copy-of-outputs-into-module-outputs-3">Store Local copy of outputs into Module Outputs</h2>
<p><em>See</em> MotAg0CoeffTblWr <em>in the FDD</em></p>
<h2 id="local-functionmacro-definitions">Local Function/Macro Definitions</h2>
<h2 id="local-function-1"> Local Function #1</h2>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>CalcCorrnTbl</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>None</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td><strong>Return Value</strong></td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h2 id="design-rationale-6">Design Rationale</h2>
<p>See “Calculate Correction Table” block in the Simulink model of the design.</p>
<h2 id="local-function-2">Local Function #2</h2>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Function Name</strong></td>
<td>CalcNtcPrm</td>
<td>Type</td>
<td>Min</td>
<td>Max</td>
</tr>
<tr class="even">
<td><strong>Arguments Passed</strong></td>
<td>MotAg0StatReg_Cnt_T_u32,</td>
<td>Uint32</td>
<td>0</td>
<td>2^32-1</td>
</tr>
<tr class="odd">
<td></td>
<td>MotAg0SyncErr_Cnt_T_lgc</td>
<td>Boolean</td>
<td>False</td>
<td>True</td>
</tr>
<tr class="even">
<td><strong>Return Value</strong></td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h2 id="design-rationale-7">Design Rationale</h2>
<p>See “SetParamByte” block in the Simulink model of the design.</p>
<h2 id="global-functionmacro-definitions">GLObAL Function/Macro Definitions</h2>
<p>None</p>
<h2 id="transient-functions">TRANSIENT FUNCTIONS </h2>
<p>None</p>
<h1 id="known-limitations-with-design">Known Limitations With Design</h1>
<blockquote>
<p>None.</p>
</blockquote>
<h1 id="unit-test-consideration">UNIT TEST CONSIDERATION</h1>
<p>Following variables are used as rolling counters, so the overflow of these variables is intentional.</p>
<p>Rte_Pim_MotAg0PrevSpiErrFltCntr</p>
<p>Rte_Pim_MotAg0PrevRollgCntr</p>
<p>There is an unreachable code in the SinCos_f32() function, because the input of this function is always positive. This is ok as the SinCos_f32() is a library function.</p>
<p>For run time efficiency in the motor control loop the <strong>Offset</strong> &amp; <strong>Compensate MechMtrPos</strong> block is implemented in a optimized way in the code by letting a uint16 variable be overflown.</p>
<h1 id="appendix">Appendix</h1>
<p>NA</p>
